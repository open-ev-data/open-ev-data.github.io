<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The single source of truth for electric vehicle specifications"><meta name=author content="OpenEV Data Contributors"><link href=https://open-ev-data.github.io/1.4.x/api/RUST_GUIDELINES/ rel=canonical><link href=../TESTING/ rel=prev><link href=../RELEASE_STRATEGY/ rel=next><link rel=icon href=../../assets/images/open-ev-data-logo-mini.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Rust Guidelines - OpenEV Data</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-9WVEN4C4XH"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-9WVEN4C4XH",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-9WVEN4C4XH",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script><meta name=google-site-verification content=fj2Tueuj9hv7V9o5XJh1a3VNQiSncuV9XcWWHU_0grM><link rel=icon href=../../assets/images/favicon.ico><script type=application/ld+json>
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "OpenEV Data",
      "url": "https://open-ev-data.github.io",
      "logo": "https://open-ev-data.github.io/assets/images/open-ev-data-logo-mini.png",
      "sameAs": [
        "https://github.com/open-ev-data"
      ]
    }
  </script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=amber> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#rust-development-guidelines-openev-data-api class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="OpenEV Data" class="md-header__button md-logo" aria-label="OpenEV Data" data-md-component=logo> <img src=../../assets/images/open-ev-data-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OpenEV Data </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Rust Guidelines </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=amber aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=amber aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/open-ev-data title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> open-ev-data </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../governance/ class=md-tabs__link> Project Governance </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> API Documentation </a> </li> <li class=md-tabs__item> <a href=../../dataset/ class=md-tabs__link> Dataset Documentation </a> </li> <li class=md-tabs__item> <a href=../../changelog-api/ class=md-tabs__link> Changelog </a> </li> <li class=md-tabs__item> <a href=../../guides/contributing/ class=md-tabs__link> Guides </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="OpenEV Data" class="md-nav__button md-logo" aria-label="OpenEV Data" data-md-component=logo> <img src=../../assets/images/open-ev-data-logo.svg alt=logo> </a> OpenEV Data </label> <div class=md-nav__source> <a href=https://github.com/open-ev-data title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> open-ev-data </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> About </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../getting-started/ class="md-nav__link "> <span class=md-ellipsis> Getting Started </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/quick-start/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../governance/ class="md-nav__link "> <span class=md-ellipsis> Project Governance </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Project Governance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../governance/GET_STARTED/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../governance/CONTRIBUTING/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../governance/CODE_OF_CONDUCT/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> API Documentation </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> API Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../GET_STARTED/ class=md-nav__link> <span class=md-ellipsis> Get Started </span> </a> </li> <li class=md-nav__item> <a href=../ARCHITECTURE/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../TESTING/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Rust Guidelines </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Rust Guidelines </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#1-core-principles class=md-nav__link> <span class=md-ellipsis> 1. Core Principles </span> </a> <nav class=md-nav aria-label="1. Core Principles"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-solid-principles-in-rust class=md-nav__link> <span class=md-ellipsis> 1.1. SOLID Principles in Rust </span> </a> <nav class=md-nav aria-label="1.1. SOLID Principles in Rust"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-responsibility-principle-srp class=md-nav__link> <span class=md-ellipsis> Single Responsibility Principle (SRP) </span> </a> </li> <li class=md-nav__item> <a href=#openclosed-principle-ocp class=md-nav__link> <span class=md-ellipsis> Open/Closed Principle (OCP) </span> </a> </li> <li class=md-nav__item> <a href=#liskov-substitution-principle-lsp class=md-nav__link> <span class=md-ellipsis> Liskov Substitution Principle (LSP) </span> </a> </li> <li class=md-nav__item> <a href=#interface-segregation-principle-isp class=md-nav__link> <span class=md-ellipsis> Interface Segregation Principle (ISP) </span> </a> </li> <li class=md-nav__item> <a href=#dependency-inversion-principle-dip class=md-nav__link> <span class=md-ellipsis> Dependency Inversion Principle (DIP) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#12-hexagonal-architecture-enforcement class=md-nav__link> <span class=md-ellipsis> 1.2. Hexagonal Architecture Enforcement </span> </a> </li> <li class=md-nav__item> <a href=#13-make-invalid-states-unrepresentable class=md-nav__link> <span class=md-ellipsis> 1.3. Make Invalid States Unrepresentable </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-project-structure class=md-nav__link> <span class=md-ellipsis> 2. Project Structure </span> </a> <nav class=md-nav aria-label="2. Project Structure"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-workspace-organization class=md-nav__link> <span class=md-ellipsis> 2.1. Workspace Organization </span> </a> </li> <li class=md-nav__item> <a href=#22-module-organization class=md-nav__link> <span class=md-ellipsis> 2.2. Module Organization </span> </a> </li> <li class=md-nav__item> <a href=#23-file-naming class=md-nav__link> <span class=md-ellipsis> 2.3. File Naming </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-naming-conventions class=md-nav__link> <span class=md-ellipsis> 3. Naming Conventions </span> </a> <nav class=md-nav aria-label="3. Naming Conventions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-general-rules class=md-nav__link> <span class=md-ellipsis> 3.1. General Rules </span> </a> </li> <li class=md-nav__item> <a href=#32-semantic-naming class=md-nav__link> <span class=md-ellipsis> 3.2. Semantic Naming </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-type-design class=md-nav__link> <span class=md-ellipsis> 4. Type Design </span> </a> <nav class=md-nav aria-label="4. Type Design"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-prefer-newtype-pattern-for-domain-concepts class=md-nav__link> <span class=md-ellipsis> 4.1. Prefer Newtype Pattern for Domain Concepts </span> </a> </li> <li class=md-nav__item> <a href=#42-use-builder-pattern-for-complex-construction class=md-nav__link> <span class=md-ellipsis> 4.2. Use Builder Pattern for Complex Construction </span> </a> </li> <li class=md-nav__item> <a href=#43-enums-for-state-representation class=md-nav__link> <span class=md-ellipsis> 4.3. Enums for State Representation </span> </a> </li> <li class=md-nav__item> <a href=#44-derive-standard-traits class=md-nav__link> <span class=md-ellipsis> 4.4. Derive Standard Traits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-error-handling class=md-nav__link> <span class=md-ellipsis> 5. Error Handling </span> </a> <nav class=md-nav aria-label="5. Error Handling"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-error-design class=md-nav__link> <span class=md-ellipsis> 5.1. Error Design </span> </a> </li> <li class=md-nav__item> <a href=#52-result-type-usage class=md-nav__link> <span class=md-ellipsis> 5.2. Result Type Usage </span> </a> </li> <li class=md-nav__item> <a href=#53-error-propagation class=md-nav__link> <span class=md-ellipsis> 5.3. Error Propagation </span> </a> </li> <li class=md-nav__item> <a href=#54-never-panic-in-libraries class=md-nav__link> <span class=md-ellipsis> 5.4. Never Panic in Libraries </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-architectural-patterns class=md-nav__link> <span class=md-ellipsis> 6. Architectural Patterns </span> </a> <nav class=md-nav aria-label="6. Architectural Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-port-and-adapter-pattern class=md-nav__link> <span class=md-ellipsis> 6.1. Port and Adapter Pattern </span> </a> </li> <li class=md-nav__item> <a href=#62-dependency-injection class=md-nav__link> <span class=md-ellipsis> 6.2. Dependency Injection </span> </a> </li> <li class=md-nav__item> <a href=#63-strategy-pattern class=md-nav__link> <span class=md-ellipsis> 6.3. Strategy Pattern </span> </a> </li> <li class=md-nav__item> <a href=#64-repository-pattern class=md-nav__link> <span class=md-ellipsis> 6.4. Repository Pattern </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-asyncawait-patterns class=md-nav__link> <span class=md-ellipsis> 7. Async/Await Patterns </span> </a> <nav class=md-nav aria-label="7. Async/Await Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-when-to-use-async class=md-nav__link> <span class=md-ellipsis> 7.1. When to Use Async </span> </a> </li> <li class=md-nav__item> <a href=#72-async-trait-methods class=md-nav__link> <span class=md-ellipsis> 7.2. Async Trait Methods </span> </a> </li> <li class=md-nav__item> <a href=#73-concurrent-processing class=md-nav__link> <span class=md-ellipsis> 7.3. Concurrent Processing </span> </a> </li> <li class=md-nav__item> <a href=#74-tokio-runtime-selection class=md-nav__link> <span class=md-ellipsis> 7.4. Tokio Runtime Selection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-testing-strategy class=md-nav__link> <span class=md-ellipsis> 8. Testing Strategy </span> </a> <nav class=md-nav aria-label="8. Testing Strategy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-test-organization class=md-nav__link> <span class=md-ellipsis> 8.1. Test Organization </span> </a> </li> <li class=md-nav__item> <a href=#82-unit-tests class=md-nav__link> <span class=md-ellipsis> 8.2. Unit Tests </span> </a> </li> <li class=md-nav__item> <a href=#83-integration-tests class=md-nav__link> <span class=md-ellipsis> 8.3. Integration Tests </span> </a> </li> <li class=md-nav__item> <a href=#84-property-based-testing class=md-nav__link> <span class=md-ellipsis> 8.4. Property-Based Testing </span> </a> </li> <li class=md-nav__item> <a href=#85-mocking class=md-nav__link> <span class=md-ellipsis> 8.5. Mocking </span> </a> </li> <li class=md-nav__item> <a href=#86-test-utilities class=md-nav__link> <span class=md-ellipsis> 8.6. Test Utilities </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-performance-guidelines class=md-nav__link> <span class=md-ellipsis> 9. Performance Guidelines </span> </a> <nav class=md-nav aria-label="9. Performance Guidelines"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#91-avoid-unnecessary-allocations class=md-nav__link> <span class=md-ellipsis> 9.1. Avoid Unnecessary Allocations </span> </a> </li> <li class=md-nav__item> <a href=#92-use-iterators-instead-of-loops class=md-nav__link> <span class=md-ellipsis> 9.2. Use Iterators Instead of Loops </span> </a> </li> <li class=md-nav__item> <a href=#93-prefer-str-over-string-in-function-parameters class=md-nav__link> <span class=md-ellipsis> 9.3. Prefer &amp;str Over String in Function Parameters </span> </a> </li> <li class=md-nav__item> <a href=#94-use-cow-for-conditional-ownership class=md-nav__link> <span class=md-ellipsis> 9.4. Use Cow for Conditional Ownership </span> </a> </li> <li class=md-nav__item> <a href=#95-parallel-processing-with-rayon class=md-nav__link> <span class=md-ellipsis> 9.5. Parallel Processing with Rayon </span> </a> </li> <li class=md-nav__item> <a href=#96-benchmarking class=md-nav__link> <span class=md-ellipsis> 9.6. Benchmarking </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#10-security-practices class=md-nav__link> <span class=md-ellipsis> 10. Security Practices </span> </a> <nav class=md-nav aria-label="10. Security Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#101-input-validation class=md-nav__link> <span class=md-ellipsis> 10.1. Input Validation </span> </a> </li> <li class=md-nav__item> <a href=#102-avoid-sql-injection class=md-nav__link> <span class=md-ellipsis> 10.2. Avoid SQL Injection </span> </a> </li> <li class=md-nav__item> <a href=#103-secrets-management class=md-nav__link> <span class=md-ellipsis> 10.3. Secrets Management </span> </a> </li> <li class=md-nav__item> <a href=#104-dependencies class=md-nav__link> <span class=md-ellipsis> 10.4. Dependencies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#11-documentation-standards class=md-nav__link> <span class=md-ellipsis> 11. Documentation Standards </span> </a> <nav class=md-nav aria-label="11. Documentation Standards"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#111-module-documentation class=md-nav__link> <span class=md-ellipsis> 11.1. Module Documentation </span> </a> </li> <li class=md-nav__item> <a href=#112-type-documentation class=md-nav__link> <span class=md-ellipsis> 11.2. Type Documentation </span> </a> </li> <li class=md-nav__item> <a href=#113-function-documentation class=md-nav__link> <span class=md-ellipsis> 11.3. Function Documentation </span> </a> </li> <li class=md-nav__item> <a href=#114-error-documentation class=md-nav__link> <span class=md-ellipsis> 11.4. Error Documentation </span> </a> </li> <li class=md-nav__item> <a href=#115-readme-per-crate class=md-nav__link> <span class=md-ellipsis> 11.5. README per Crate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#12-code-quality-tools class=md-nav__link> <span class=md-ellipsis> 12. Code Quality Tools </span> </a> <nav class=md-nav aria-label="12. Code Quality Tools"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-rustfmt-configuration class=md-nav__link> <span class=md-ellipsis> 12.1. Rustfmt Configuration </span> </a> </li> <li class=md-nav__item> <a href=#122-clippy-configuration class=md-nav__link> <span class=md-ellipsis> 12.2. Clippy Configuration </span> </a> </li> <li class=md-nav__item> <a href=#123-allowed-lints-when-necessary class=md-nav__link> <span class=md-ellipsis> 12.3. Allowed Lints (When Necessary) </span> </a> </li> <li class=md-nav__item> <a href=#124-ci-quality-gates class=md-nav__link> <span class=md-ellipsis> 12.4. CI Quality Gates </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#13-common-patterns class=md-nav__link> <span class=md-ellipsis> 13. Common Patterns </span> </a> <nav class=md-nav aria-label="13. Common Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#131-configuration-management class=md-nav__link> <span class=md-ellipsis> 13.1. Configuration Management </span> </a> </li> <li class=md-nav__item> <a href=#132-logging class=md-nav__link> <span class=md-ellipsis> 13.2. Logging </span> </a> </li> <li class=md-nav__item> <a href=#133-extension-traits class=md-nav__link> <span class=md-ellipsis> 13.3. Extension Traits </span> </a> </li> <li class=md-nav__item> <a href=#134-type-state-pattern class=md-nav__link> <span class=md-ellipsis> 13.4. Type State Pattern </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#14-anti-patterns-to-avoid class=md-nav__link> <span class=md-ellipsis> 14. Anti-Patterns to Avoid </span> </a> <nav class=md-nav aria-label="14. Anti-Patterns to Avoid"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#141-stringly-typed-code class=md-nav__link> <span class=md-ellipsis> 14.1. Stringly-Typed Code </span> </a> </li> <li class=md-nav__item> <a href=#142-overusing-clone class=md-nav__link> <span class=md-ellipsis> 14.2. Overusing clone() </span> </a> </li> <li class=md-nav__item> <a href=#143-god-objects class=md-nav__link> <span class=md-ellipsis> 14.3. God Objects </span> </a> </li> <li class=md-nav__item> <a href=#144-ignoring-results class=md-nav__link> <span class=md-ellipsis> 14.4. Ignoring Results </span> </a> </li> <li class=md-nav__item> <a href=#145-using-unwrap-in-production-code class=md-nav__link> <span class=md-ellipsis> 14.5. Using unwrap() in Production Code </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../RELEASE_STRATEGY/ class=md-nav__link> <span class=md-ellipsis> Release Strategy </span> </a> </li> <li class=md-nav__item> <a href=../API_ERRORS/ class=md-nav__link> <span class=md-ellipsis> API Errors </span> </a> </li> <li class=md-nav__item> <a href=../PROBLEM_DETAILS_RFC_7807/ class=md-nav__link> <span class=md-ellipsis> Problem Details RFC </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex> <span class=md-ellipsis> Crates </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> Crates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../CRATE_EV_CORE/ class=md-nav__link> <span class=md-ellipsis> ev-core </span> </a> </li> <li class=md-nav__item> <a href=../CRATE_EV_ETL/ class=md-nav__link> <span class=md-ellipsis> ev-etl </span> </a> </li> <li class=md-nav__item> <a href=../CRATE_EV_SERVER/ class=md-nav__link> <span class=md-ellipsis> ev-server </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../dataset/ class="md-nav__link "> <span class=md-ellipsis> Dataset Documentation </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Dataset Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../dataset/HOW_TO_CONSUME/ class=md-nav__link> <span class=md-ellipsis> How to Consume </span> </a> </li> <li class=md-nav__item> <a href=../../dataset/ARCHITECTURE/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../dataset/SCHEMA/ class=md-nav__link> <span class=md-ellipsis> Schema Reference </span> </a> </li> <li class=md-nav__item> <a href=../../dataset/CONTRIBUTING_VEHICLES/ class=md-nav__link> <span class=md-ellipsis> Contributing Vehicles </span> </a> </li> <li class=md-nav__item> <a href=../../dataset/RELEASE_PROCESS/ class=md-nav__link> <span class=md-ellipsis> Release Process </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Changelog </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Changelog </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../changelog-api/ class=md-nav__link> <span class=md-ellipsis> API Changelog </span> </a> </li> <li class=md-nav__item> <a href=../../changelog-dataset/ class=md-nav__link> <span class=md-ellipsis> Dataset Changelog </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <nav class=md-path aria-label=Navigation> <ol class=md-path__list> <li class=md-path__item> <a href=../.. class=md-path__link> <span class=md-ellipsis> About </span> </a> </li> <li class=md-path__item> <a href=../ class=md-path__link> <span class=md-ellipsis> API Documentation </span> </a> </li> </ol> </nav> <article class="md-content__inner md-typeset"> <h1 id=rust-development-guidelines-openev-data-api>Rust Development Guidelines - OpenEV Data API<a class=headerlink href=#rust-development-guidelines-openev-data-api title="Anchor link to this section for reference">&para;</a></h1> <p>This document establishes the coding standards, best practices, and architectural guidelines for developing the OpenEV Data API in Rust. All contributors must follow these guidelines to ensure code quality, maintainability, and consistency.</p> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Anchor link to this section for reference">&para;</a></h2> <ul> <li><a href=#1-core-principles>1. Core Principles</a></li> <li><a href=#2-project-structure>2. Project Structure</a></li> <li><a href=#3-naming-conventions>3. Naming Conventions</a></li> <li><a href=#4-type-design>4. Type Design</a></li> <li><a href=#5-error-handling>5. Error Handling</a></li> <li><a href=#6-architectural-patterns>6. Architectural Patterns</a></li> <li><a href=#7-asyncawait-patterns>7. Async/Await Patterns</a></li> <li><a href=#8-testing-strategy>8. Testing Strategy</a></li> <li><a href=#9-performance-guidelines>9. Performance Guidelines</a></li> <li><a href=#10-security-practices>10. Security Practices</a></li> <li><a href=#11-documentation-standards>11. Documentation Standards</a></li> <li><a href=#12-code-quality-tools>12. Code Quality Tools</a></li> <li><a href=#13-common-patterns>13. Common Patterns</a></li> <li><a href=#14-anti-patterns-to-avoid>14. Anti-Patterns to Avoid</a></li> </ul> <hr> <h2 id=1-core-principles>1. Core Principles<a class=headerlink href=#1-core-principles title="Anchor link to this section for reference">&para;</a></h2> <h3 id=11-solid-principles-in-rust>1.1. SOLID Principles in Rust<a class=headerlink href=#11-solid-principles-in-rust title="Anchor link to this section for reference">&para;</a></h3> <h4 id=single-responsibility-principle-srp>Single Responsibility Principle (SRP)<a class=headerlink href=#single-responsibility-principle-srp title="Anchor link to this section for reference">&para;</a></h4> <p>Each module, struct, and function should have ONE clear responsibility.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// Each struct has a single responsibility</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleReader</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=c1>// Only reads vehicle files</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=p>}</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleValidator</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=c1>// Only validates vehicle data</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=p>}</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=c1>// Only handles vehicle persistence</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Bad:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// This struct does too many things</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleManager</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=c1>// Reads, validates, transforms, saves, queries...</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=p>}</span>
</span></code></pre></div></p> <h4 id=openclosed-principle-ocp>Open/Closed Principle (OCP)<a class=headerlink href=#openclosed-principle-ocp title="Anchor link to this section for reference">&para;</a></h4> <p>Types should be open for extension but closed for modification. Use traits for extensibility.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1>// Define behavior through traits</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>OutputGenerator</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>generate</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>Vehicle</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=p>}</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1>// Easy to add new formats without modifying existing code</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>JsonGenerator</span><span class=p>;</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=k>impl</span><span class=w> </span><span class=n>OutputGenerator</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>JsonGenerator</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>SqliteGenerator</span><span class=p>;</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=k>impl</span><span class=w> </span><span class=n>OutputGenerator</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>SqliteGenerator</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div></p> <h4 id=liskov-substitution-principle-lsp>Liskov Substitution Principle (LSP)<a class=headerlink href=#liskov-substitution-principle-lsp title="Anchor link to this section for reference">&para;</a></h4> <p>Implementations should be substitutable for their trait bounds without breaking behavior.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>VehicleStore</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>find</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=p>}</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=c1>// Both implementations respect the contract</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleStore</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>SqliteStore</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleStore</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>PostgresStore</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div></p> <h4 id=interface-segregation-principle-isp>Interface Segregation Principle (ISP)<a class=headerlink href=#interface-segregation-principle-isp title="Anchor link to this section for reference">&para;</a></h4> <p>Clients should not depend on traits they don't use. Keep traits focused.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1>// Segregated traits</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>Readable</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>read</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=p>}</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>Writable</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>write</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=p>}</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=c1>// Implement only what you need</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a><span class=k>impl</span><span class=w> </span><span class=n>Readable</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>ReadOnlyStore</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=k>impl</span><span class=w> </span><span class=n>Readable</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>Writable</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>FullStore</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* ... */</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Bad:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>// Fat trait forcing unnecessary implementations</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>Repository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>read</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>write</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>delete</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>update</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>}</span>
</span></code></pre></div></p> <h4 id=dependency-inversion-principle-dip>Dependency Inversion Principle (DIP)<a class=headerlink href=#dependency-inversion-principle-dip title="Anchor link to this section for reference">&para;</a></h4> <p>Depend on abstractions (traits), not concrete types.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1>// Depend on trait, not concrete type</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>EtlPipeline</span><span class=o>&lt;</span><span class=n>G</span><span class=p>:</span><span class=w> </span><span class=nc>OutputGenerator</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=n>generator</span><span class=p>:</span><span class=w> </span><span class=nc>G</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=p>}</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=k>impl</span><span class=o>&lt;</span><span class=n>G</span><span class=p>:</span><span class=w> </span><span class=nc>OutputGenerator</span><span class=o>&gt;</span><span class=w> </span><span class=n>EtlPipeline</span><span class=o>&lt;</span><span class=n>G</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=n>generator</span><span class=p>:</span><span class=w> </span><span class=nc>G</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Self</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>generator</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Bad:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1>// Hardcoded dependency on concrete type</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>EtlPipeline</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=n>generator</span><span class=p>:</span><span class=w> </span><span class=nc>JsonGenerator</span><span class=p>,</span><span class=w> </span><span class=c1>// Tightly coupled</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=p>}</span>
</span></code></pre></div></p> <h3 id=12-hexagonal-architecture-enforcement>1.2. Hexagonal Architecture Enforcement<a class=headerlink href=#12-hexagonal-architecture-enforcement title="Anchor link to this section for reference">&para;</a></h3> <p>The codebase is divided into layers with strict dependency rules:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>         Adapters (Outer)            
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>  (ev-etl, ev-server)               
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>          depends on               
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>         Core (Inner)                
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>         (ev-core)                   
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>     no dependencies               
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span></code></pre></div> <p><strong>Rules:</strong> 1. <strong>ev-core</strong> must NOT depend on ev-etl or ev-server 2. <strong>ev-core</strong> must NOT import any I/O, HTTP, or database crates 3. <strong>ev-etl</strong> and <strong>ev-server</strong> can depend on ev-core 4. <strong>Adapters communicate with Core through trait boundaries</strong></p> <h3 id=13-make-invalid-states-unrepresentable>1.3. Make Invalid States Unrepresentable<a class=headerlink href=#13-make-invalid-states-unrepresentable title="Anchor link to this section for reference">&para;</a></h3> <p>Use Rust's type system to prevent invalid states at compile time.</p> <p><strong>Good:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>// Impossible to have a vehicle without required fields</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nc>SlugName</span><span class=p>,</span><span class=w>          </span><span class=c1>// Cannot be empty</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>model</span><span class=p>:</span><span class=w> </span><span class=nc>SlugName</span><span class=p>,</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=nc>Year</span><span class=p>,</span><span class=w>              </span><span class=c1>// Validated range (1900-2100)</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>battery</span><span class=p>:</span><span class=w> </span><span class=nc>BatterySpecs</span><span class=p>,</span><span class=w>   </span><span class=c1>// At least one capacity required</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=p>}</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=c1>// Year is constrained</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Year</span><span class=p>(</span><span class=kt>u16</span><span class=p>);</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=k>impl</span><span class=w> </span><span class=n>Year</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=bp>Self</span><span class=p>,</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=mi>1900</span><span class=o>..=</span><span class=mi>2100</span><span class=p>).</span><span class=n>contains</span><span class=p>(</span><span class=o>&amp;</span><span class=n>value</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>            </span><span class=nb>Ok</span><span class=p>(</span><span class=n>Year</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>        </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=n>ValidationError</span><span class=p>::</span><span class=n>InvalidYear</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Bad:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>// Many ways to be invalid</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span><span class=w>      </span><span class=c1>// Could be None</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>model</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=kt>i32</span><span class=p>,</span><span class=w>                 </span><span class=c1>// Could be negative or 9999</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>battery</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Battery</span><span class=o>&gt;</span><span class=p>,</span><span class=w>  </span><span class=c1>// Could be None</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=p>}</span>
</span></code></pre></div></p> <hr> <h2 id=2-project-structure>2. Project Structure<a class=headerlink href=#2-project-structure title="Anchor link to this section for reference">&para;</a></h2> <h3 id=21-workspace-organization>2.1. Workspace Organization<a class=headerlink href=#21-workspace-organization title="Anchor link to this section for reference">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a>Cargo.toml                    # Workspace manifest
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a> crates/
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    ev-core/             # Domain logic (no dependencies)
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>       src/
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>          lib.rs       # Public API surface
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>          domain/      # Domain entities
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a>          validation/  # Validation logic
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a>          error.rs     # Core error types
</span><span id=__span-11-9><a id=__codelineno-11-9 name=__codelineno-11-9 href=#__codelineno-11-9></a>       Cargo.toml
</span><span id=__span-11-10><a id=__codelineno-11-10 name=__codelineno-11-10 href=#__codelineno-11-10></a>   
</span><span id=__span-11-11><a id=__codelineno-11-11 name=__codelineno-11-11 href=#__codelineno-11-11></a>    ev-etl/              # CLI adapter
</span><span id=__span-11-12><a id=__codelineno-11-12 name=__codelineno-11-12 href=#__codelineno-11-12></a>       src/
</span><span id=__span-11-13><a id=__codelineno-11-13 name=__codelineno-11-13 href=#__codelineno-11-13></a>          main.rs      # Binary entry
</span><span id=__span-11-14><a id=__codelineno-11-14 name=__codelineno-11-14 href=#__codelineno-11-14></a>          cli.rs       # Argument parsing
</span><span id=__span-11-15><a id=__codelineno-11-15 name=__codelineno-11-15 href=#__codelineno-11-15></a>          ingest/      # Input adapters
</span><span id=__span-11-16><a id=__codelineno-11-16 name=__codelineno-11-16 href=#__codelineno-11-16></a>          output/      # Output adapters
</span><span id=__span-11-17><a id=__codelineno-11-17 name=__codelineno-11-17 href=#__codelineno-11-17></a>          error.rs     # ETL-specific errors
</span><span id=__span-11-18><a id=__codelineno-11-18 name=__codelineno-11-18 href=#__codelineno-11-18></a>       Cargo.toml
</span><span id=__span-11-19><a id=__codelineno-11-19 name=__codelineno-11-19 href=#__codelineno-11-19></a>   
</span><span id=__span-11-20><a id=__codelineno-11-20 name=__codelineno-11-20 href=#__codelineno-11-20></a>    ev-server/           # HTTP API adapter
</span><span id=__span-11-21><a id=__codelineno-11-21 name=__codelineno-11-21 href=#__codelineno-11-21></a>        src/
</span><span id=__span-11-22><a id=__codelineno-11-22 name=__codelineno-11-22 href=#__codelineno-11-22></a>           main.rs      # Binary entry
</span><span id=__span-11-23><a id=__codelineno-11-23 name=__codelineno-11-23 href=#__codelineno-11-23></a>           api/         # HTTP handlers
</span><span id=__span-11-24><a id=__codelineno-11-24 name=__codelineno-11-24 href=#__codelineno-11-24></a>           db/          # Database adapters
</span><span id=__span-11-25><a id=__codelineno-11-25 name=__codelineno-11-25 href=#__codelineno-11-25></a>           error.rs     # Server-specific errors
</span><span id=__span-11-26><a id=__codelineno-11-26 name=__codelineno-11-26 href=#__codelineno-11-26></a>        Cargo.toml
</span></code></pre></div> <h3 id=22-module-organization>2.2. Module Organization<a class=headerlink href=#22-module-organization title="Anchor link to this section for reference">&para;</a></h3> <p>Each crate should follow this internal structure:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>// lib.rs or main.rs - Define public API</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>pub</span><span class=w> </span><span class=k>mod</span><span class=w> </span><span class=nn>domain</span><span class=p>;</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=k>pub</span><span class=w> </span><span class=k>mod</span><span class=w> </span><span class=nn>validation</span><span class=p>;</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=k>pub</span><span class=w> </span><span class=k>use</span><span class=w> </span><span class=n>domain</span><span class=p>::{</span><span class=n>Vehicle</span><span class=p>,</span><span class=w> </span><span class=n>Battery</span><span class=p>};</span><span class=w>  </span><span class=c1>// Re-export public types</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=k>pub</span><span class=w> </span><span class=k>use</span><span class=w> </span><span class=n>validation</span><span class=p>::</span><span class=n>Validator</span><span class=p>;</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=c1>// Private modules</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=k>mod</span><span class=w> </span><span class=nn>internal</span><span class=p>;</span>
</span></code></pre></div> <h3 id=23-file-naming>2.3. File Naming<a class=headerlink href=#23-file-naming title="Anchor link to this section for reference">&para;</a></h3> <ul> <li><strong>snake_case</strong> for file names: <code>vehicle_repository.rs</code></li> <li><strong>mod.rs</strong> for module entry points</li> <li>One public type per file (generally)</li> <li>Related types can share a file if small</li> </ul> <hr> <h2 id=3-naming-conventions>3. Naming Conventions<a class=headerlink href=#3-naming-conventions title="Anchor link to this section for reference">&para;</a></h2> <h3 id=31-general-rules>3.1. General Rules<a class=headerlink href=#31-general-rules title="Anchor link to this section for reference">&para;</a></h3> <table> <thead> <tr> <th>Item</th> <th>Convention</th> <th>Example</th> </tr> </thead> <tbody> <tr> <td>Crates</td> <td>kebab-case</td> <td><code>ev-core</code>, <code>ev-etl</code></td> </tr> <tr> <td>Modules</td> <td>snake_case</td> <td><code>vehicle_store</code>, <code>json_parser</code></td> </tr> <tr> <td>Types</td> <td>PascalCase</td> <td><code>Vehicle</code>, <code>BatterySpecs</code></td> </tr> <tr> <td>Traits</td> <td>PascalCase</td> <td><code>OutputGenerator</code>, <code>Validator</code></td> </tr> <tr> <td>Functions</td> <td>snake_case</td> <td><code>load_vehicles()</code>, <code>validate_schema()</code></td> </tr> <tr> <td>Methods</td> <td>snake_case</td> <td><code>.to_json()</code>, <code>.save()</code></td> </tr> <tr> <td>Constants</td> <td>SCREAMING_SNAKE_CASE</td> <td><code>MAX_VEHICLES</code>, <code>DEFAULT_PORT</code></td> </tr> <tr> <td>Statics</td> <td>SCREAMING_SNAKE_CASE</td> <td><code>GLOBAL_CONFIG</code></td> </tr> <tr> <td>Lifetimes</td> <td>lowercase, short</td> <td><code>'a</code>, <code>'b</code>, <code>'static</code></td> </tr> <tr> <td>Type parameters</td> <td>PascalCase, single letter</td> <td><code>T</code>, <code>E</code>, or descriptive: <code>TOutput</code></td> </tr> </tbody> </table> <h3 id=32-semantic-naming>3.2. Semantic Naming<a class=headerlink href=#32-semantic-naming title="Anchor link to this section for reference">&para;</a></h3> <p><strong>Types should indicate their purpose:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// Good - Clear intent</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleRepository</span><span class=p>;</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>JsonSerializer</span><span class=p>;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>ValidationError</span><span class=p>;</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=c1>// Bad - Vague or generic</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Manager</span><span class=p>;</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Handler</span><span class=p>;</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Data</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Functions should be verbs or verb phrases:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1>// Good</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>fn</span><span class=w> </span><span class=nf>load_dataset</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Dataset</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=k>fn</span><span class=w> </span><span class=nf>validate_vehicle</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=k>fn</span><span class=w> </span><span class=nf>merge_json_files</span><span class=p>(</span><span class=n>files</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>File</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Json</span><span class=p>;</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=c1>// Bad</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=k>fn</span><span class=w> </span><span class=nf>dataset</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Dataset</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=k>fn</span><span class=w> </span><span class=nf>vehicle</span><span class=p>(</span><span class=n>v</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Avoid abbreviations unless widely known:</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1>// Good</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=n>http_client</span><span class=p>,</span><span class=w> </span><span class=n>database_url</span><span class=p>,</span><span class=w> </span><span class=n>repository</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=c1>// Acceptable</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=n>url</span><span class=p>,</span><span class=w> </span><span class=n>json</span><span class=p>,</span><span class=w> </span><span class=n>xml</span><span class=p>,</span><span class=w> </span><span class=n>html</span><span class=p>,</span><span class=w> </span><span class=n>api</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=c1>// Bad</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=n>veh</span><span class=p>,</span><span class=w> </span><span class=n>db_repo</span><span class=p>,</span><span class=w> </span><span class=n>usr</span>
</span></code></pre></div></p> <hr> <h2 id=4-type-design>4. Type Design<a class=headerlink href=#4-type-design title="Anchor link to this section for reference">&para;</a></h2> <h3 id=41-prefer-newtype-pattern-for-domain-concepts>4.1. Prefer Newtype Pattern for Domain Concepts<a class=headerlink href=#41-prefer-newtype-pattern-for-domain-concepts title="Anchor link to this section for reference">&para;</a></h3> <p>Wrap primitive types to add semantic meaning and validation.</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1>// Good - Type-safe and self-documenting</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=cp>#[derive(Debug, Clone, PartialEq, Eq)]</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleId</span><span class=p>(</span><span class=nb>String</span><span class=p>);</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleId</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=bp>Self</span><span class=p>,</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=n>value</span><span class=p>.</span><span class=n>is_empty</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>ValidationError</span><span class=p>::</span><span class=n>EmptyId</span><span class=p>);</span>
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>VehicleId</span><span class=p>(</span><span class=n>value</span><span class=p>))</span>
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=p>}</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>
</span><span id=__span-16-14><a id=__codelineno-16-14 name=__codelineno-16-14 href=#__codelineno-16-14></a><span class=c1>// Bad - Easy to confuse different strings</span>
</span><span id=__span-16-15><a id=__codelineno-16-15 name=__codelineno-16-15 href=#__codelineno-16-15></a><span class=k>fn</span><span class=w> </span><span class=nf>get_vehicle</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>;</span>
</span><span id=__span-16-16><a id=__codelineno-16-16 name=__codelineno-16-16 href=#__codelineno-16-16></a><span class=k>fn</span><span class=w> </span><span class=nf>get_make</span><span class=p>(</span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-16-17><a id=__codelineno-16-17 name=__codelineno-16-17 href=#__codelineno-16-17></a><span class=c1>// Which string is which?</span>
</span></code></pre></div> <h3 id=42-use-builder-pattern-for-complex-construction>4.2. Use Builder Pattern for Complex Construction<a class=headerlink href=#42-use-builder-pattern-for-complex-construction title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=cp>#[derive(Debug)]</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleBuilder</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>    </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>SlugName</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>    </span><span class=n>model</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>SlugName</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>    </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Year</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=n>battery</span><span class=p>:</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>BatterySpecs</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=p>}</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleBuilder</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Self</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>        </span><span class=bp>Self</span><span class=p>::</span><span class=n>default</span><span class=p>()</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>make</span><span class=p>(</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nc>SlugName</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Self</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>make</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>make</span><span class=p>);</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>        </span><span class=bp>self</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>build</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=p>,</span><span class=w> </span><span class=n>BuilderError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=w>            </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nc>self</span><span class=p>.</span><span class=n>make</span><span class=p>.</span><span class=n>ok_or</span><span class=p>(</span><span class=n>BuilderError</span><span class=p>::</span><span class=n>MissingMake</span><span class=p>)</span><span class=o>?</span><span class=p>,</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=w>            </span><span class=n>model</span><span class=p>:</span><span class=w> </span><span class=nc>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>ok_or</span><span class=p>(</span><span class=n>BuilderError</span><span class=p>::</span><span class=n>MissingModel</span><span class=p>)</span><span class=o>?</span><span class=p>,</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>            </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=nc>self</span><span class=p>.</span><span class=n>year</span><span class=p>.</span><span class=n>ok_or</span><span class=p>(</span><span class=n>BuilderError</span><span class=p>::</span><span class=n>MissingYear</span><span class=p>)</span><span class=o>?</span><span class=p>,</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=w>            </span><span class=n>battery</span><span class=p>:</span><span class=w> </span><span class=nc>self</span><span class=p>.</span><span class=n>battery</span><span class=p>.</span><span class=n>ok_or</span><span class=p>(</span><span class=n>BuilderError</span><span class=p>::</span><span class=n>MissingBattery</span><span class=p>)</span><span class=o>?</span><span class=p>,</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=w>        </span><span class=p>})</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=p>}</span>
</span></code></pre></div> <h3 id=43-enums-for-state-representation>4.3. Enums for State Representation<a class=headerlink href=#43-enums-for-state-representation title="Anchor link to this section for reference">&para;</a></h3> <p>Use enums to represent mutually exclusive states.</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1>// Good - Clear states</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=cp>#[derive(Debug, Clone, PartialEq)]</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=k>pub</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=nc>VehicleAvailability</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=n>Production</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>start_year</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=n>Discontinued</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>end_year</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=n>Concept</span><span class=p>,</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>    </span><span class=n>Announced</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>expected_year</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=p>}</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1>// Bad - Multiple booleans</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleAvailability</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>is_production</span><span class=p>:</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>is_discontinued</span><span class=p>:</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>is_concept</span><span class=p>:</span><span class=w> </span><span class=kt>bool</span><span class=p>,</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a><span class=w>    </span><span class=c1>// Unclear which combination is valid</span>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=44-derive-standard-traits>4.4. Derive Standard Traits<a class=headerlink href=#44-derive-standard-traits title="Anchor link to this section for reference">&para;</a></h3> <p>Always derive standard traits when possible:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=cp>#[derive(Debug, Clone, PartialEq, Eq, Hash)]</span><span class=w>          </span><span class=c1>// For most types</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=cp>#[derive(Debug, Clone, PartialEq)]</span><span class=w>                    </span><span class=c1>// For types with floats</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=cp>#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]</span><span class=w>   </span><span class=c1>// For small copyable types</span>
</span></code></pre></div> <p>For public domain types, also derive: <div class="language-rust highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=cp>#[derive(Debug, Clone, PartialEq, serde::Serialize, serde::Deserialize)]</span>
</span></code></pre></div></p> <hr> <h2 id=5-error-handling>5. Error Handling<a class=headerlink href=#5-error-handling title="Anchor link to this section for reference">&para;</a></h2> <h3 id=51-error-design>5.1. Error Design<a class=headerlink href=#51-error-design title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>thiserror</code> for library errors (ev-core) and <code>anyhow</code> for application errors (ev-etl, ev-server).</p> <p><strong>ev-core (library errors):</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=k>use</span><span class=w> </span><span class=n>thiserror</span><span class=p>::</span><span class=n>Error</span><span class=p>;</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=cp>#[derive(Debug, Error)]</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=k>pub</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=nc>ValidationError</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;Missing required field: {field}&quot;</span><span class=cp>)]</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=n>MissingField</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>field</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=w> </span><span class=p>},</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;Invalid year: {0}. Must be between 1900 and 2100&quot;</span><span class=cp>)]</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>    </span><span class=n>InvalidYear</span><span class=p>(</span><span class=kt>u16</span><span class=p>),</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;At least one battery capacity (gross or net) is required&quot;</span><span class=cp>)]</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>    </span><span class=n>MissingBatteryCapacity</span><span class=p>,</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;Schema validation failed: {0}&quot;</span><span class=cp>)]</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>    </span><span class=n>SchemaError</span><span class=p>(</span><span class=nb>String</span><span class=p>),</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>ev-etl, ev-server (application errors):</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>use</span><span class=w> </span><span class=n>anyhow</span><span class=p>::{</span><span class=n>Context</span><span class=p>,</span><span class=w> </span><span class=nb>Result</span><span class=p>};</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>load_dataset</span><span class=p>(</span><span class=n>path</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Path</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Dataset</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>file</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>File</span><span class=p>::</span><span class=n>open</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>        </span><span class=p>.</span><span class=n>context</span><span class=p>(</span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;Failed to open dataset file: {:?}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>))</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>dataset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span><span class=p>::</span><span class=n>from_reader</span><span class=p>(</span><span class=n>file</span><span class=p>)</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>        </span><span class=p>.</span><span class=n>context</span><span class=p>(</span><span class=s>&quot;Failed to parse JSON&quot;</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>dataset</span><span class=p>)</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=p>}</span>
</span></code></pre></div></p> <h3 id=52-result-type-usage>5.2. Result Type Usage<a class=headerlink href=#52-result-type-usage title="Anchor link to this section for reference">&para;</a></h3> <p>Always use <code>Result</code> for operations that can fail:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1>// Good</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>validate_vehicle</span><span class=p>(</span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>save_to_db</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=c1>// Bad - panicking in library code</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>validate_vehicle</span><span class=p>(</span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>    </span><span class=fm>assert!</span><span class=p>(</span><span class=o>!</span><span class=n>vehicle</span><span class=p>.</span><span class=n>make</span><span class=p>.</span><span class=n>is_empty</span><span class=p>());</span><span class=w>  </span><span class=c1>// NO!</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=p>}</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=c1>// Bad - hiding errors</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>save_to_db</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=p>;</span>
</span></code></pre></div> <h3 id=53-error-propagation>5.3. Error Propagation<a class=headerlink href=#53-error-propagation title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>?</code> operator for error propagation:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>process_vehicle</span><span class=p>(</span><span class=n>path</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Path</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>raw_json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>::</span><span class=n>fs</span><span class=p>::</span><span class=n>read_to_string</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span><span class=p>::</span><span class=n>from_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>raw_json</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=n>vehicle</span><span class=p>.</span><span class=n>validate</span><span class=p>()</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=nb>Ok</span><span class=p>(</span><span class=n>vehicle</span><span class=p>)</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=p>}</span>
</span></code></pre></div> <h3 id=54-never-panic-in-libraries>5.4. Never Panic in Libraries<a class=headerlink href=#54-never-panic-in-libraries title="Anchor link to this section for reference">&para;</a></h3> <p>Libraries (ev-core) should NEVER panic. Applications can panic for unrecoverable errors.</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1>// Library code - NO PANIC</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>parse_year</span><span class=p>(</span><span class=n>s</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Year</span><span class=p>,</span><span class=w> </span><span class=n>ParseError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>value</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>parse</span><span class=p>()</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>        </span><span class=p>.</span><span class=n>map_err</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=w> </span><span class=n>ParseError</span><span class=p>::</span><span class=n>InvalidFormat</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=n>Year</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=p>}</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=c1>// Application code - panic is acceptable for truly unrecoverable errors</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>config</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>load_config</span><span class=p>()</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>        </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&quot;Configuration file is required&quot;</span><span class=p>);</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=6-architectural-patterns>6. Architectural Patterns<a class=headerlink href=#6-architectural-patterns title="Anchor link to this section for reference">&para;</a></h2> <h3 id=61-port-and-adapter-pattern>6.1. Port and Adapter Pattern<a class=headerlink href=#61-port-and-adapter-pattern title="Anchor link to this section for reference">&para;</a></h3> <p>Define traits (ports) in ev-core, implement them (adapters) in outer crates.</p> <p><strong>ev-core (port definition):</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1>// Port - abstract interface</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>VehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>list_all</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>ev-server (adapter implementation):</strong> <div class="language-rust highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>// Adapter - concrete implementation</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>SqliteVehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=n>connection</span><span class=p>:</span><span class=w> </span><span class=nc>rusqlite</span><span class=p>::</span><span class=n>Connection</span><span class=p>,</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=p>}</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleRepository</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>SqliteVehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=w>        </span><span class=c1>// SQLite-specific implementation</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=w>        </span><span class=c1>// SQLite-specific implementation</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>list_all</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a><span class=w>        </span><span class=c1>// SQLite-specific implementation</span>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a><span class=p>}</span>
</span></code></pre></div></p> <h3 id=62-dependency-injection>6.2. Dependency Injection<a class=headerlink href=#62-dependency-injection title="Anchor link to this section for reference">&para;</a></h3> <p>Use constructor injection with trait bounds:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>// Service depends on abstraction, not implementation</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>EtlPipeline</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span><span class=w> </span><span class=n>G</span><span class=o>&gt;</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=k>where</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>    </span><span class=n>R</span><span class=p>:</span><span class=w> </span><span class=nc>VehicleRepository</span><span class=p>,</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>    </span><span class=n>G</span><span class=p>:</span><span class=w> </span><span class=nc>OutputGenerator</span><span class=p>,</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=p>{</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>    </span><span class=n>repository</span><span class=p>:</span><span class=w> </span><span class=nc>R</span><span class=p>,</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>    </span><span class=n>generator</span><span class=p>:</span><span class=w> </span><span class=nc>G</span><span class=p>,</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=p>}</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=k>impl</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span><span class=w> </span><span class=n>G</span><span class=o>&gt;</span><span class=w> </span><span class=n>EtlPipeline</span><span class=o>&lt;</span><span class=n>R</span><span class=p>,</span><span class=w> </span><span class=n>G</span><span class=o>&gt;</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=k>where</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>    </span><span class=n>R</span><span class=p>:</span><span class=w> </span><span class=nc>VehicleRepository</span><span class=p>,</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=w>    </span><span class=n>G</span><span class=p>:</span><span class=w> </span><span class=nc>OutputGenerator</span><span class=p>,</span>
</span><span id=__span-28-15><a id=__codelineno-28-15 name=__codelineno-28-15 href=#__codelineno-28-15></a><span class=p>{</span>
</span><span id=__span-28-16><a id=__codelineno-28-16 name=__codelineno-28-16 href=#__codelineno-28-16></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=n>repository</span><span class=p>:</span><span class=w> </span><span class=nc>R</span><span class=p>,</span><span class=w> </span><span class=n>generator</span><span class=p>:</span><span class=w> </span><span class=nc>G</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Self</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-17><a id=__codelineno-28-17 name=__codelineno-28-17 href=#__codelineno-28-17></a><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>repository</span><span class=p>,</span><span class=w> </span><span class=n>generator</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-28-18><a id=__codelineno-28-18 name=__codelineno-28-18 href=#__codelineno-28-18></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-28-19><a id=__codelineno-28-19 name=__codelineno-28-19 href=#__codelineno-28-19></a>
</span><span id=__span-28-20><a id=__codelineno-28-20 name=__codelineno-28-20 href=#__codelineno-28-20></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>process</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-21><a id=__codelineno-28-21 name=__codelineno-28-21 href=#__codelineno-28-21></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>vehicles</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-22><a id=__codelineno-28-22 name=__codelineno-28-22 href=#__codelineno-28-22></a><span class=w>            </span><span class=bp>self</span><span class=p>.</span><span class=n>repository</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=n>vehicle</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-28-23><a id=__codelineno-28-23 name=__codelineno-28-23 href=#__codelineno-28-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-28-24><a id=__codelineno-28-24 name=__codelineno-28-24 href=#__codelineno-28-24></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>all_vehicles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>repository</span><span class=p>.</span><span class=n>list_all</span><span class=p>()</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-28-25><a id=__codelineno-28-25 name=__codelineno-28-25 href=#__codelineno-28-25></a><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>generator</span><span class=p>.</span><span class=n>generate</span><span class=p>(</span><span class=o>&amp;</span><span class=n>all_vehicles</span><span class=p>)</span>
</span><span id=__span-28-26><a id=__codelineno-28-26 name=__codelineno-28-26 href=#__codelineno-28-26></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-28-27><a id=__codelineno-28-27 name=__codelineno-28-27 href=#__codelineno-28-27></a><span class=p>}</span>
</span></code></pre></div> <h3 id=63-strategy-pattern>6.3. Strategy Pattern<a class=headerlink href=#63-strategy-pattern title="Anchor link to this section for reference">&para;</a></h3> <p>Use traits to define interchangeable algorithms:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>MergeStrategy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>base</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>,</span><span class=w> </span><span class=n>overlay</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Json</span><span class=p>;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=p>}</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>DeepMergeStrategy</span><span class=p>;</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=k>impl</span><span class=w> </span><span class=n>MergeStrategy</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>DeepMergeStrategy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>base</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>,</span><span class=w> </span><span class=n>overlay</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Json</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>        </span><span class=c1>// Deep merge implementation</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=p>}</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>ShallowMergeStrategy</span><span class=p>;</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=k>impl</span><span class=w> </span><span class=n>MergeStrategy</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>ShallowMergeStrategy</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>merge</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>base</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>,</span><span class=w> </span><span class=n>overlay</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Json</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Json</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a><span class=w>        </span><span class=c1>// Shallow merge implementation</span>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a><span class=p>}</span>
</span></code></pre></div> <h3 id=64-repository-pattern>6.4. Repository Pattern<a class=headerlink href=#64-repository-pattern title="Anchor link to this section for reference">&para;</a></h3> <p>Separate data access from business logic:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1>// Repository handles persistence</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleRepositoryImpl</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>    </span><span class=n>db</span><span class=p>:</span><span class=w> </span><span class=nc>Database</span><span class=p>,</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=p>}</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleRepositoryImpl</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>to_domain</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>row</span><span class=p>:</span><span class=w> </span><span class=nc>DbRow</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>        </span><span class=c1>// Map database row to domain entity</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>from_domain</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>DbRow</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=w>        </span><span class=c1>// Map domain entity to database row</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=7-asyncawait-patterns>7. Async/Await Patterns<a class=headerlink href=#7-asyncawait-patterns title="Anchor link to this section for reference">&para;</a></h2> <h3 id=71-when-to-use-async>7.1. When to Use Async<a class=headerlink href=#71-when-to-use-async title="Anchor link to this section for reference">&para;</a></h3> <p>Use async for: - HTTP requests/responses (ev-server) - Database connections with async drivers - Concurrent I/O operations</p> <p>Don't use async for: - Pure computation - ev-core (domain logic should be sync) - ETL processing (unless parallelizing I/O)</p> <h3 id=72-async-trait-methods>7.2. Async Trait Methods<a class=headerlink href=#72-async-trait-methods title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>async-trait</code> crate for trait methods:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=k>use</span><span class=w> </span><span class=n>async_trait</span><span class=p>::</span><span class=n>async_trait</span><span class=p>;</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=cp>#[async_trait]</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>AsyncVehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=p>}</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=cp>#[async_trait]</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=k>impl</span><span class=w> </span><span class=n>AsyncVehicleRepository</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>PostgresRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=w>        </span><span class=c1>// Async implementation</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=w>    </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=w>        </span><span class=c1>// Async implementation</span>
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=p>}</span>
</span></code></pre></div> <h3 id=73-concurrent-processing>7.3. Concurrent Processing<a class=headerlink href=#73-concurrent-processing title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>tokio::spawn</code> for true parallelism, <code>futures::join!</code> for concurrent awaiting:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=k>use</span><span class=w> </span><span class=n>futures</span><span class=p>::</span><span class=n>future</span><span class=p>::</span><span class=n>join_all</span><span class=p>;</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>load_multiple_vehicles</span><span class=p>(</span><span class=n>ids</span><span class=p>:</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>futures</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ids</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>        </span><span class=p>.</span><span class=n>into_iter</span><span class=p>()</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>id</span><span class=o>|</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>move</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>            </span><span class=n>load_vehicle</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>).</span><span class=k>await</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>        </span><span class=p>});</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>    </span><span class=n>join_all</span><span class=p>(</span><span class=n>futures</span><span class=p>).</span><span class=k>await</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>        </span><span class=p>.</span><span class=n>into_iter</span><span class=p>()</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>::</span><span class=o>&lt;</span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>_</span><span class=o>&gt;&gt;&gt;</span><span class=p>()</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=p>}</span>
</span></code></pre></div> <h3 id=74-tokio-runtime-selection>7.4. Tokio Runtime Selection<a class=headerlink href=#74-tokio-runtime-selection title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>// For servers - multi-threaded runtime</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=cp>#[tokio::main]</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=c1>// Server code</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=p>}</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=c1>// For CLIs - current thread runtime (lighter)</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=cp>#[tokio::main(flavor = </span><span class=s>&quot;current_thread&quot;</span><span class=cp>)]</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>main</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=c1>// CLI code</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=8-testing-strategy>8. Testing Strategy<a class=headerlink href=#8-testing-strategy title="Anchor link to this section for reference">&para;</a></h2> <h3 id=81-test-organization>8.1. Test Organization<a class=headerlink href=#81-test-organization title="Anchor link to this section for reference">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a>src/
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>  vehicle.rs
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>  vehicle_repository.rs
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>tests/                          # Integration tests
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>  vehicle_integration_test.rs
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>benches/                        # Benchmarks
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>  vehicle_benchmark.rs
</span></code></pre></div> <h3 id=82-unit-tests>8.2. Unit Tests<a class=headerlink href=#82-unit-tests title="Anchor link to this section for reference">&para;</a></h3> <p>Place unit tests in the same file as the code:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=p>}</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=k>impl</span><span class=w> </span><span class=n>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>is_available_in_year</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>        </span><span class=c1>// implementation</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=p>}</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=cp>#[cfg(test)]</span>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=k>mod</span><span class=w> </span><span class=nn>tests</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a>
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>    </span><span class=cp>#[test]</span>
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>test_vehicle_availability</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Vehicle</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>);</span>
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a><span class=w>        </span><span class=fm>assert!</span><span class=p>(</span><span class=n>vehicle</span><span class=p>.</span><span class=n>is_available_in_year</span><span class=p>(</span><span class=mi>2024</span><span class=p>));</span>
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=w>        </span><span class=fm>assert!</span><span class=p>(</span><span class=o>!</span><span class=n>vehicle</span><span class=p>.</span><span class=n>is_available_in_year</span><span class=p>(</span><span class=mi>1999</span><span class=p>));</span>
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a>
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a><span class=w>    </span><span class=cp>#[test]</span>
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>test_invalid_year_returns_error</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Year</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=mi>3000</span><span class=p>);</span>
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>        </span><span class=fm>assert!</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>is_err</span><span class=p>());</span>
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=p>}</span>
</span></code></pre></div> <h3 id=83-integration-tests>8.3. Integration Tests<a class=headerlink href=#83-integration-tests title="Anchor link to this section for reference">&para;</a></h3> <p>Place integration tests in <code>tests/</code> directory:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1>// tests/etl_pipeline_test.rs</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=k>use</span><span class=w> </span><span class=n>ev_etl</span><span class=p>::</span><span class=n>EtlPipeline</span><span class=p>;</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=k>use</span><span class=w> </span><span class=n>ev_core</span><span class=p>::</span><span class=n>Vehicle</span><span class=p>;</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=cp>#[test]</span>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=k>fn</span><span class=w> </span><span class=nf>test_full_etl_pipeline</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>input_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;fixtures/sample_vehicles&quot;</span><span class=p>;</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>output_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>temp_dir</span><span class=p>();</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EtlPipeline</span><span class=p>::</span><span class=n>new</span><span class=p>()</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>        </span><span class=p>.</span><span class=n>input</span><span class=p>(</span><span class=n>input_dir</span><span class=p>)</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>        </span><span class=p>.</span><span class=n>output</span><span class=p>(</span><span class=n>output_dir</span><span class=p>)</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>        </span><span class=p>.</span><span class=n>formats</span><span class=p>(</span><span class=fm>vec!</span><span class=p>[</span><span class=s>&quot;json&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;sqlite&quot;</span><span class=p>])</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>        </span><span class=p>.</span><span class=n>run</span><span class=p>();</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>    </span><span class=fm>assert!</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>is_ok</span><span class=p>());</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>    </span><span class=fm>assert!</span><span class=p>(</span><span class=n>output_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;vehicles.json&quot;</span><span class=p>).</span><span class=n>exists</span><span class=p>());</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=w>    </span><span class=fm>assert!</span><span class=p>(</span><span class=n>output_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;vehicles.db&quot;</span><span class=p>).</span><span class=n>exists</span><span class=p>());</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a><span class=p>}</span>
</span></code></pre></div> <h3 id=84-property-based-testing>8.4. Property-Based Testing<a class=headerlink href=#84-property-based-testing title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>proptest</code> for property-based testing:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>use</span><span class=w> </span><span class=n>proptest</span><span class=p>::</span><span class=n>prelude</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=n>proptest</span><span class=o>!</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>    </span><span class=cp>#[test]</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>test_year_roundtrip</span><span class=p>(</span><span class=n>year</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=mi>1900</span><span class=k>u16</span><span class=o>..=</span><span class=mi>2100</span><span class=k>u16</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Year</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>year</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>json</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span><span class=p>::</span><span class=n>to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=n>y</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>parsed</span><span class=p>:</span><span class=w> </span><span class=nc>Year</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>serde_json</span><span class=p>::</span><span class=n>from_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>json</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>        </span><span class=n>prop_assert_eq</span><span class=o>!</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=n>parsed</span><span class=p>);</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=p>}</span>
</span></code></pre></div> <h3 id=85-mocking>8.5. Mocking<a class=headerlink href=#85-mocking title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>mockall</code> for mocking traits:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>use</span><span class=w> </span><span class=n>mockall</span><span class=p>::{</span><span class=n>automock</span><span class=p>,</span><span class=w> </span><span class=n>predicate</span><span class=p>::</span><span class=o>*</span><span class=p>};</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=cp>#[automock]</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>VehicleRepository</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Option</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=p>}</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=cp>#[cfg(test)]</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=k>mod</span><span class=w> </span><span class=nn>tests</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=k>super</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>    </span><span class=cp>#[test]</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>test_service_with_mock_repository</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>mock_repo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MockVehicleRepository</span><span class=p>::</span><span class=n>new</span><span class=p>();</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>        </span><span class=n>mock_repo</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=w>            </span><span class=p>.</span><span class=n>expect_find_by_id</span><span class=p>()</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=w>            </span><span class=p>.</span><span class=n>with</span><span class=p>(</span><span class=n>eq</span><span class=p>(</span><span class=n>VehicleId</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=s>&quot;test&quot;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()).</span><span class=n>unwrap</span><span class=p>()))</span>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=w>            </span><span class=p>.</span><span class=n>times</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-38-19><a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>            </span><span class=p>.</span><span class=n>returning</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=nb>Some</span><span class=p>(</span><span class=n>create_test_vehicle</span><span class=p>())));</span>
</span><span id=__span-38-20><a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a>
</span><span id=__span-38-21><a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>service</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>VehicleService</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>mock_repo</span><span class=p>);</span>
</span><span id=__span-38-22><a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>service</span><span class=p>.</span><span class=n>get_vehicle_details</span><span class=p>(</span><span class=o>&amp;</span><span class=n>VehicleId</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=s>&quot;test&quot;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()).</span><span class=n>unwrap</span><span class=p>());</span>
</span><span id=__span-38-23><a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=w>        </span><span class=fm>assert!</span><span class=p>(</span><span class=n>result</span><span class=p>.</span><span class=n>is_ok</span><span class=p>());</span>
</span><span id=__span-38-24><a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-38-25><a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=p>}</span>
</span></code></pre></div> <h3 id=86-test-utilities>8.6. Test Utilities<a class=headerlink href=#86-test-utilities title="Anchor link to this section for reference">&para;</a></h3> <p>Create test helpers in a common module:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1>// tests/common/mod.rs</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=cp>#![allow(dead_code)]</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=k>use</span><span class=w> </span><span class=n>ev_core</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>create_test_vehicle</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>    </span><span class=n>VehicleBuilder</span><span class=p>::</span><span class=n>new</span><span class=p>()</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>        </span><span class=p>.</span><span class=n>make</span><span class=p>(</span><span class=n>SlugName</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=s>&quot;test_make&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Test Make&quot;</span><span class=p>).</span><span class=n>unwrap</span><span class=p>())</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=w>        </span><span class=p>.</span><span class=n>model</span><span class=p>(</span><span class=n>SlugName</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=s>&quot;test_model&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Test Model&quot;</span><span class=p>).</span><span class=n>unwrap</span><span class=p>())</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>        </span><span class=p>.</span><span class=n>year</span><span class=p>(</span><span class=n>Year</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=mi>2024</span><span class=p>).</span><span class=n>unwrap</span><span class=p>())</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=w>        </span><span class=p>.</span><span class=n>battery</span><span class=p>(</span><span class=n>create_test_battery</span><span class=p>())</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=w>        </span><span class=p>.</span><span class=n>build</span><span class=p>()</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=w>        </span><span class=p>.</span><span class=n>unwrap</span><span class=p>()</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=p>}</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>create_test_battery</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>BatterySpecs</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>    </span><span class=n>BatterySpecs</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>        </span><span class=n>pack_capacity_kwh_net</span><span class=p>:</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=mf>60.0</span><span class=p>),</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>        </span><span class=n>thermal_management</span><span class=p>:</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>ThermalManagement</span><span class=p>::</span><span class=n>Liquid</span><span class=p>),</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>        </span><span class=o>..</span><span class=nb>Default</span><span class=p>::</span><span class=n>default</span><span class=p>()</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=p>}</span>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=c1>// tests/vehicle_test.rs</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=k>mod</span><span class=w> </span><span class=nn>common</span><span class=p>;</span>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=cp>#[test]</span>
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=k>fn</span><span class=w> </span><span class=nf>test_something</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>common</span><span class=p>::</span><span class=n>create_test_vehicle</span><span class=p>();</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=9-performance-guidelines>9. Performance Guidelines<a class=headerlink href=#9-performance-guidelines title="Anchor link to this section for reference">&para;</a></h2> <h3 id=91-avoid-unnecessary-allocations>9.1. Avoid Unnecessary Allocations<a class=headerlink href=#91-avoid-unnecessary-allocations title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1>// Good - borrows instead of cloning</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>process_vehicles</span><span class=p>(</span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>Vehicle</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>    </span><span class=n>vehicles</span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>format_vehicle</span><span class=p>(</span><span class=n>v</span><span class=p>))</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>()</span>
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a><span class=p>}</span>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a><span class=c1>// Bad - unnecessary clone</span>
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>process_vehicles</span><span class=p>(</span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>Vehicle</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=w>    </span><span class=n>vehicles</span><span class=p>.</span><span class=n>to_vec</span><span class=p>()</span><span class=w>  </span><span class=c1>// Clones all vehicles!</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a><span class=w>        </span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>format_vehicle</span><span class=p>(</span><span class=n>v</span><span class=p>))</span>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>()</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a><span class=p>}</span>
</span></code></pre></div> <h3 id=92-use-iterators-instead-of-loops>9.2. Use Iterators Instead of Loops<a class=headerlink href=#92-use-iterators-instead-of-loops title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1>// Good - iterator chain</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=kd>let</span><span class=w> </span><span class=n>total_capacity</span><span class=p>:</span><span class=w> </span><span class=kt>f64</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vehicles</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>    </span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>    </span><span class=p>.</span><span class=n>filter</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>year</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2024</span><span class=p>)</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span><span class=p>.</span><span class=n>filter_map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>battery</span><span class=p>.</span><span class=n>pack_capacity_kwh_net</span><span class=p>)</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>    </span><span class=p>.</span><span class=n>sum</span><span class=p>();</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=c1>// Bad - manual loop</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>total_capacity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>0.0</span><span class=p>;</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=k>for</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>vehicles</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>year</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2024</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>capacity</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>battery</span><span class=p>.</span><span class=n>pack_capacity_kwh_net</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=w>            </span><span class=n>total_capacity</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>capacity</span><span class=p>;</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=93-prefer-str-over-string-in-function-parameters>9.3. Prefer <code>&amp;str</code> Over <code>String</code> in Function Parameters<a class=headerlink href=#93-prefer-str-over-string-in-function-parameters title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1>// Good - accepts both String and &amp;str</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>parse_vehicle_id</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>    </span><span class=n>VehicleId</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>id</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=p>}</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=c1>// Bad - forces caller to own a String</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>parse_vehicle_id</span><span class=p>(</span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>VehicleId</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>    </span><span class=n>VehicleId</span><span class=p>::</span><span class=n>new</span><span class=p>(</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=p>}</span>
</span></code></pre></div> <h3 id=94-use-cow-for-conditional-ownership>9.4. Use <code>Cow</code> for Conditional Ownership<a class=headerlink href=#94-use-cow-for-conditional-ownership title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>use</span><span class=w> </span><span class=n>std</span><span class=p>::</span><span class=n>borrow</span><span class=p>::</span><span class=n>Cow</span><span class=p>;</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>normalize_slug</span><span class=p>(</span><span class=n>s</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Cow</span><span class=o>&lt;</span><span class=kt>str</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>chars</span><span class=p>().</span><span class=n>all</span><span class=p>(</span><span class=o>|</span><span class=n>c</span><span class=o>|</span><span class=w> </span><span class=n>c</span><span class=p>.</span><span class=n>is_ascii_lowercase</span><span class=p>()</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>c</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=sc>&#39;_&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>        </span><span class=n>Cow</span><span class=p>::</span><span class=n>Borrowed</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=w>  </span><span class=c1>// No allocation needed</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>        </span><span class=n>Cow</span><span class=p>::</span><span class=n>Owned</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>to_lowercase</span><span class=p>().</span><span class=n>replace</span><span class=p>(</span><span class=sc>&#39;-&#39;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;_&quot;</span><span class=p>))</span><span class=w>  </span><span class=c1>// Allocate only if needed</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=p>}</span>
</span></code></pre></div> <h3 id=95-parallel-processing-with-rayon>9.5. Parallel Processing with Rayon<a class=headerlink href=#95-parallel-processing-with-rayon title="Anchor link to this section for reference">&para;</a></h3> <p>For CPU-bound work, use <code>rayon</code>:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=k>use</span><span class=w> </span><span class=n>rayon</span><span class=p>::</span><span class=n>prelude</span><span class=p>::</span><span class=o>*</span><span class=p>;</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>validate_all_vehicles</span><span class=p>(</span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>    </span><span class=n>vehicles</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=w>        </span><span class=p>.</span><span class=n>par_iter</span><span class=p>()</span><span class=w>  </span><span class=c1>// Parallel iterator</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>validate</span><span class=p>())</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>()</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=p>}</span>
</span></code></pre></div> <h3 id=96-benchmarking>9.6. Benchmarking<a class=headerlink href=#96-benchmarking title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>criterion</code> for benchmarking:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1>// benches/vehicle_benchmark.rs</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=k>use</span><span class=w> </span><span class=n>criterion</span><span class=p>::{</span><span class=n>black_box</span><span class=p>,</span><span class=w> </span><span class=n>criterion_group</span><span class=p>,</span><span class=w> </span><span class=n>criterion_main</span><span class=p>,</span><span class=w> </span><span class=n>Criterion</span><span class=p>};</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=k>use</span><span class=w> </span><span class=n>ev_core</span><span class=p>::</span><span class=n>Vehicle</span><span class=p>;</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=k>fn</span><span class=w> </span><span class=nf>benchmark_vehicle_validation</span><span class=p>(</span><span class=n>c</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Criterion</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>create_test_vehicle</span><span class=p>();</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>    </span><span class=n>c</span><span class=p>.</span><span class=n>bench_function</span><span class=p>(</span><span class=s>&quot;validate_vehicle&quot;</span><span class=p>,</span><span class=w> </span><span class=o>|</span><span class=n>b</span><span class=o>|</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>        </span><span class=n>b</span><span class=p>.</span><span class=n>iter</span><span class=p>(</span><span class=o>||</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a><span class=w>            </span><span class=n>vehicle</span><span class=p>.</span><span class=n>validate</span><span class=p>()</span>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=w>        </span><span class=p>});</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=p>}</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=n>criterion_group</span><span class=o>!</span><span class=p>(</span><span class=n>benches</span><span class=p>,</span><span class=w> </span><span class=n>benchmark_vehicle_validation</span><span class=p>);</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=n>criterion_main</span><span class=o>!</span><span class=p>(</span><span class=n>benches</span><span class=p>);</span>
</span></code></pre></div> <hr> <h2 id=10-security-practices>10. Security Practices<a class=headerlink href=#10-security-practices title="Anchor link to this section for reference">&para;</a></h2> <h3 id=101-input-validation>10.1. Input Validation<a class=headerlink href=#101-input-validation title="Anchor link to this section for reference">&para;</a></h3> <p>Always validate untrusted input:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>load_vehicle_from_file</span><span class=p>(</span><span class=n>path</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Path</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=w>    </span><span class=c1>// Validate path is within expected directory</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>canonical_path</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>path</span><span class=p>.</span><span class=n>canonicalize</span><span class=p>()</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=o>!</span><span class=n>canonical_path</span><span class=p>.</span><span class=n>starts_with</span><span class=p>(</span><span class=s>&quot;/allowed/directory&quot;</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>SecurityError</span><span class=p>::</span><span class=n>InvalidPath</span><span class=p>.</span><span class=n>into</span><span class=p>());</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=w>    </span><span class=c1>// Limit file size</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>::</span><span class=n>fs</span><span class=p>::</span><span class=n>metadata</span><span class=p>(</span><span class=o>&amp;</span><span class=n>canonical_path</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>metadata</span><span class=p>.</span><span class=n>len</span><span class=p>()</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>MAX_FILE_SIZE</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>SecurityError</span><span class=p>::</span><span class=n>FileTooLarge</span><span class=p>.</span><span class=n>into</span><span class=p>());</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a><span class=w>    </span><span class=c1>// Parse with size limits</span>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=p>::</span><span class=n>fs</span><span class=p>::</span><span class=n>read_to_string</span><span class=p>(</span><span class=o>&amp;</span><span class=n>canonical_path</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=w>    </span><span class=n>serde_json</span><span class=p>::</span><span class=n>from_str</span><span class=p>(</span><span class=o>&amp;</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>        </span><span class=p>.</span><span class=n>map_err</span><span class=p>(</span><span class=o>|</span><span class=n>e</span><span class=o>|</span><span class=w> </span><span class=n>e</span><span class=p>.</span><span class=n>into</span><span class=p>())</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a><span class=p>}</span>
</span></code></pre></div> <h3 id=102-avoid-sql-injection>10.2. Avoid SQL Injection<a class=headerlink href=#102-avoid-sql-injection title="Anchor link to this section for reference">&para;</a></h3> <p>Use parameterized queries:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1>// Good - parameterized</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>find_vehicles_by_make</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>stmt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>conn</span><span class=p>.</span><span class=n>prepare</span><span class=p>(</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>        </span><span class=s>&quot;SELECT * FROM vehicles WHERE make_slug = ?1&quot;</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>    </span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=w>    </span><span class=n>stmt</span><span class=p>.</span><span class=n>query_map</span><span class=p>([</span><span class=n>make</span><span class=p>],</span><span class=w> </span><span class=o>|</span><span class=n>row</span><span class=o>|</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=w>        </span><span class=c1>// Map row to Vehicle</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=w>    </span><span class=p>})</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=p>}</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=c1>// Bad - string concatenation (SQL injection risk)</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>find_vehicles_by_make</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>Vec</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;SELECT * FROM vehicles WHERE make_slug = &#39;{}&#39;&quot;</span><span class=p>,</span><span class=w> </span><span class=n>make</span><span class=p>);</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=w>    </span><span class=c1>// NEVER DO THIS</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=103-secrets-management>10.3. Secrets Management<a class=headerlink href=#103-secrets-management title="Anchor link to this section for reference">&para;</a></h3> <p>Never hardcode secrets:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=c1>// Good - environment variable</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>database_url</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>    </span><span class=n>std</span><span class=p>::</span><span class=n>env</span><span class=p>::</span><span class=n>var</span><span class=p>(</span><span class=s>&quot;DATABASE_URL&quot;</span><span class=p>)</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>        </span><span class=p>.</span><span class=n>context</span><span class=p>(</span><span class=s>&quot;DATABASE_URL environment variable not set&quot;</span><span class=p>)</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=p>}</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=c1>// Bad - hardcoded</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>database_url</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>String</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>    </span><span class=s>&quot;postgresql://user:password123@localhost/db&quot;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=p>}</span>
</span></code></pre></div> <h3 id=104-dependencies>10.4. Dependencies<a class=headerlink href=#104-dependencies title="Anchor link to this section for reference">&para;</a></h3> <ul> <li>Review dependencies before adding</li> <li>Use <code>cargo audit</code> regularly</li> <li>Pin dependency versions in <code>Cargo.lock</code></li> <li>Prefer well-maintained crates</li> </ul> <hr> <h2 id=11-documentation-standards>11. Documentation Standards<a class=headerlink href=#11-documentation-standards title="Anchor link to this section for reference">&para;</a></h2> <h3 id=111-module-documentation>11.1. Module Documentation<a class=headerlink href=#111-module-documentation title="Anchor link to this section for reference">&para;</a></h3> <p>Every module should have a doc comment:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=sd>//! Vehicle repository implementations.</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=sd>//!</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=sd>//! This module provides database access for vehicle entities through</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=sd>//! implementations of the `VehicleRepository` trait.</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=sd>//!</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=sd>//! # Examples</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=sd>//!</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=sd>//! ```</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a><span class=sd>//! use ev_core::{Vehicle, VehicleRepository};</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=sd>//!</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=sd>//! let repo = SqliteVehicleRepository::new(&quot;vehicles.db&quot;)?;</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=sd>//! let vehicle = repo.find_by_id(&amp;id)?;</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a><span class=sd>//! ```</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=k>pub</span><span class=w> </span><span class=k>mod</span><span class=w> </span><span class=nn>sqlite</span><span class=p>;</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a><span class=k>pub</span><span class=w> </span><span class=k>mod</span><span class=w> </span><span class=nn>postgresql</span><span class=p>;</span>
</span></code></pre></div> <h3 id=112-type-documentation>11.2. Type Documentation<a class=headerlink href=#112-type-documentation title="Anchor link to this section for reference">&para;</a></h3> <p>Document all public types:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=sd>/// Represents an electric vehicle with complete specifications.</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=sd>///</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=sd>/// A `Vehicle` contains all the essential information about an EV including</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=sd>/// manufacturer details, battery specifications, charging capabilities, and</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=sd>/// performance metrics.</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=sd>///</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=sd>/// # Examples</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=sd>///</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=sd>/// ```</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=sd>/// use ev_core::{Vehicle, VehicleBuilder};</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=sd>///</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=sd>/// let vehicle = VehicleBuilder::new()</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=sd>///     .make(&quot;tesla&quot;, &quot;Tesla&quot;)</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=sd>///     .model(&quot;model_3&quot;, &quot;Model 3&quot;)</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=sd>///     .year(2024)</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a><span class=sd>///     .build()?;</span>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=sd>/// ```</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a><span class=cp>#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]</span>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=w>    </span><span class=sd>/// Vehicle manufacturer information</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>make</span><span class=p>:</span><span class=w> </span><span class=nc>SlugName</span><span class=p>,</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=w>    </span><span class=sd>/// Vehicle model name and slug</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>model</span><span class=p>:</span><span class=w> </span><span class=nc>SlugName</span><span class=p>,</span>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a><span class=w>    </span><span class=sd>/// Model year (1900-2100)</span>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>year</span><span class=p>:</span><span class=w> </span><span class=nc>Year</span><span class=p>,</span>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a>
</span><span id=__span-50-29><a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a><span class=w>    </span><span class=sd>/// Battery specifications and capabilities</span>
</span><span id=__span-50-30><a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>battery</span><span class=p>:</span><span class=w> </span><span class=nc>BatterySpecs</span><span class=p>,</span>
</span><span id=__span-50-31><a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a><span class=p>}</span>
</span></code></pre></div> <h3 id=113-function-documentation>11.3. Function Documentation<a class=headerlink href=#113-function-documentation title="Anchor link to this section for reference">&para;</a></h3> <p>Document public functions with examples:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=sd>/// Validates a vehicle against the JSON schema and business rules.</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=sd>///</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=sd>/// # Errors</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=sd>///</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=sd>/// Returns `ValidationError` if:</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=sd>/// - Required fields are missing</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=sd>/// - Values are out of valid range</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=sd>/// - Business rules are violated</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=sd>///</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a><span class=sd>/// # Examples</span>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=sd>///</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=sd>/// ```</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=sd>/// let vehicle = create_test_vehicle();</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=sd>/// assert!(validate_vehicle(&amp;vehicle).is_ok());</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a><span class=sd>/// ```</span>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>validate_vehicle</span><span class=p>(</span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>(),</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>    </span><span class=c1>// Implementation</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a><span class=p>}</span>
</span></code></pre></div> <h3 id=114-error-documentation>11.4. Error Documentation<a class=headerlink href=#114-error-documentation title="Anchor link to this section for reference">&para;</a></h3> <p>Document error variants:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=sd>/// Errors that can occur during vehicle validation.</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=cp>#[derive(Debug, Error)]</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=k>pub</span><span class=w> </span><span class=k>enum</span><span class=w> </span><span class=nc>ValidationError</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=sd>/// A required field is missing from the vehicle data.</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>    </span><span class=sd>///</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=w>    </span><span class=sd>/// This typically indicates incomplete input data.</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;Missing required field: {field}&quot;</span><span class=cp>)]</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>    </span><span class=n>MissingField</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a><span class=w>        </span><span class=sd>/// The name of the missing field</span>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=w>        </span><span class=n>field</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>,</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=w>    </span><span class=p>},</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=w>    </span><span class=sd>/// The year value is outside the valid range (1900-2100).</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=w>    </span><span class=cp>#[error(</span><span class=s>&quot;Invalid year: {0}. Must be between 1900 and 2100&quot;</span><span class=cp>)]</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=w>    </span><span class=n>InvalidYear</span><span class=p>(</span><span class=kt>u16</span><span class=p>),</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=115-readme-per-crate>11.5. README per Crate<a class=headerlink href=#115-readme-per-crate title="Anchor link to this section for reference">&para;</a></h3> <p>Each crate should have a README.md:</p> <div class="language-markdown highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=gh># ev-core</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>Core domain types and validation logic for OpenEV Data.
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=gu>## Features</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=k>-</span><span class=w> </span>Type-safe domain entities
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=k>-</span><span class=w> </span>Comprehensive validation
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=k>-</span><span class=w> </span>Zero I/O dependencies
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=gu>## Usage</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=sb>```rust</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=k>use</span><span class=w> </span><span class=n>ev_core</span><span class=p>::{</span><span class=n>Vehicle</span><span class=p>,</span><span class=w> </span><span class=n>VehicleBuilder</span><span class=p>};</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>VehicleBuilder</span><span class=p>::</span><span class=n>new</span><span class=p>()</span>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=w>    </span><span class=p>.</span><span class=n>make</span><span class=p>(</span><span class=s>&quot;tesla&quot;</span><span class=p>,</span><span class=w> </span><span class=s>&quot;Tesla&quot;</span><span class=p>)</span>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a><span class=w>    </span><span class=p>.</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=sb>```</span>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=gu>## Architecture</span>
</span><span id=__span-53-22><a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a>
</span><span id=__span-53-23><a id=__codelineno-53-23 name=__codelineno-53-23 href=#__codelineno-53-23></a>This crate forms the Core of the Hexagonal Architecture and has no
</span><span id=__span-53-24><a id=__codelineno-53-24 name=__codelineno-53-24 href=#__codelineno-53-24></a>dependencies on I/O, HTTP, or database libraries.
</span></code></pre></div> <hr> <h2 id=12-code-quality-tools>12. Code Quality Tools<a class=headerlink href=#12-code-quality-tools title="Anchor link to this section for reference">&para;</a></h2> <h3 id=121-rustfmt-configuration>12.1. Rustfmt Configuration<a class=headerlink href=#121-rustfmt-configuration title="Anchor link to this section for reference">&para;</a></h3> <p>Create <code>.rustfmt.toml</code>:</p> <div class="language-toml highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=n>edition</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;2024&quot;</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=n>max_width</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>100</span>
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a><span class=n>tab_spaces</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>4</span>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=n>newline_style</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Unix&quot;</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=n>use_small_heuristics</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Default&quot;</span>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a><span class=n>imports_granularity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;Crate&quot;</span>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=n>group_imports</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&quot;StdExternalCrate&quot;</span>
</span></code></pre></div> <h3 id=122-clippy-configuration>12.2. Clippy Configuration<a class=headerlink href=#122-clippy-configuration title="Anchor link to this section for reference">&para;</a></h3> <p>Create <code>.clippy.toml</code>:</p> <div class="language-toml highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=n>cognitive-complexity-threshold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>30</span>
</span></code></pre></div> <p>Run with strict lints:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a>cargo<span class=w> </span>clippy<span class=w> </span>--all-features<span class=w> </span>--<span class=w> </span>-D<span class=w> </span>warnings<span class=w> </span><span class=se>\</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a><span class=w>    </span>-W<span class=w> </span>clippy::pedantic<span class=w> </span><span class=se>\</span>
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=w>    </span>-W<span class=w> </span>clippy::nursery<span class=w> </span><span class=se>\</span>
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=w>    </span>-W<span class=w> </span>clippy::unwrap_used<span class=w> </span><span class=se>\</span>
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a><span class=w>    </span>-W<span class=w> </span>clippy::expect_used
</span></code></pre></div> <h3 id=123-allowed-lints-when-necessary>12.3. Allowed Lints (When Necessary)<a class=headerlink href=#123-allowed-lints-when-necessary title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=c1>// At crate level for specific exceptions</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a><span class=cp>#![allow(clippy::module_name_repetitions)]</span><span class=w>  </span><span class=c1>// Vehicle in VehicleRepository</span>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=c1>// At item level for specific cases</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=cp>#[allow(clippy::too_many_arguments)]</span><span class=w>  </span><span class=c1>// Rare, justified cases</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>complex_function</span><span class=p>(</span><span class=cm>/* many params */</span><span class=p>)</span><span class=w> </span><span class=p>{}</span>
</span></code></pre></div> <h3 id=124-ci-quality-gates>12.4. CI Quality Gates<a class=headerlink href=#124-ci-quality-gates title="Anchor link to this section for reference">&para;</a></h3> <p>All code must pass:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=c1># Format check</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>cargo<span class=w> </span>fmt<span class=w> </span>--all<span class=w> </span>--<span class=w> </span>--check
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=c1># Linting</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a>cargo<span class=w> </span>clippy<span class=w> </span>--all-targets<span class=w> </span>--all-features<span class=w> </span>--<span class=w> </span>-D<span class=w> </span>warnings
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a><span class=c1># Tests</span>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a>cargo<span class=w> </span><span class=nb>test</span><span class=w> </span>--all-features
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=c1># Documentation</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a>cargo<span class=w> </span>doc<span class=w> </span>--no-deps<span class=w> </span>--all-features
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=c1># Audit</span>
</span><span id=__span-58-14><a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a>cargo<span class=w> </span>audit
</span></code></pre></div> <hr> <h2 id=13-common-patterns>13. Common Patterns<a class=headerlink href=#13-common-patterns title="Anchor link to this section for reference">&para;</a></h2> <h3 id=131-configuration-management>13.1. Configuration Management<a class=headerlink href=#131-configuration-management title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=k>use</span><span class=w> </span><span class=n>serde</span><span class=p>::</span><span class=n>Deserialize</span><span class=p>;</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a><span class=cp>#[derive(Debug, Deserialize)]</span>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>database_url</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>,</span>
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>port</span><span class=p>:</span><span class=w> </span><span class=kt>u16</span><span class=p>,</span>
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a><span class=w>    </span><span class=cp>#[serde(default = </span><span class=s>&quot;default_log_level&quot;</span><span class=cp>)]</span>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>log_level</span><span class=p>:</span><span class=w> </span><span class=nb>String</span><span class=p>,</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a><span class=p>}</span>
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=k>fn</span><span class=w> </span><span class=nf>default_log_level</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>String</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a><span class=w>    </span><span class=s>&quot;info&quot;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()</span>
</span><span id=__span-59-13><a id=__codelineno-59-13 name=__codelineno-59-13 href=#__codelineno-59-13></a><span class=p>}</span>
</span><span id=__span-59-14><a id=__codelineno-59-14 name=__codelineno-59-14 href=#__codelineno-59-14></a>
</span><span id=__span-59-15><a id=__codelineno-59-15 name=__codelineno-59-15 href=#__codelineno-59-15></a><span class=k>impl</span><span class=w> </span><span class=n>Config</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-59-16><a id=__codelineno-59-16 name=__codelineno-59-16 href=#__codelineno-59-16></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>from_env</span><span class=p>()</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=bp>Self</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-59-17><a id=__codelineno-59-17 name=__codelineno-59-17 href=#__codelineno-59-17></a><span class=w>        </span><span class=n>envy</span><span class=p>::</span><span class=n>from_env</span><span class=p>().</span><span class=n>context</span><span class=p>(</span><span class=s>&quot;Failed to load configuration from environment&quot;</span><span class=p>)</span>
</span><span id=__span-59-18><a id=__codelineno-59-18 name=__codelineno-59-18 href=#__codelineno-59-18></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-59-19><a id=__codelineno-59-19 name=__codelineno-59-19 href=#__codelineno-59-19></a><span class=p>}</span>
</span></code></pre></div> <h3 id=132-logging>13.2. Logging<a class=headerlink href=#132-logging title="Anchor link to this section for reference">&para;</a></h3> <p>Use <code>tracing</code> for structured logging:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=k>use</span><span class=w> </span><span class=n>tracing</span><span class=p>::{</span><span class=n>info</span><span class=p>,</span><span class=w> </span><span class=n>warn</span><span class=p>,</span><span class=w> </span><span class=n>error</span><span class=p>,</span><span class=w> </span><span class=n>debug</span><span class=p>,</span><span class=w> </span><span class=n>instrument</span><span class=p>};</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=cp>#[instrument(skip(repository))]</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=k>pub</span><span class=w> </span><span class=k>async</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>load_vehicle</span><span class=p>(</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>    </span><span class=n>id</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>VehicleId</span><span class=p>,</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>    </span><span class=n>repository</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>impl</span><span class=w> </span><span class=n>VehicleRepository</span><span class=p>,</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=w>    </span><span class=n>debug</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;Loading vehicle with id: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=n>find_by_id</span><span class=p>(</span><span class=n>id</span><span class=p>).</span><span class=k>await</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=w>        </span><span class=nb>Some</span><span class=p>(</span><span class=n>v</span><span class=p>)</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>            </span><span class=n>info</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;Successfully loaded vehicle: {} {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>make</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>model</span><span class=p>);</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>            </span><span class=nb>Ok</span><span class=p>(</span><span class=n>v</span><span class=p>)</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=w>        </span><span class=nb>None</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=w>            </span><span class=n>warn</span><span class=o>!</span><span class=p>(</span><span class=s>&quot;Vehicle not found: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span>
</span><span id=__span-60-19><a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a><span class=w>            </span><span class=nb>Err</span><span class=p>(</span><span class=n>VehicleError</span><span class=p>::</span><span class=n>NotFound</span><span class=p>)</span>
</span><span id=__span-60-20><a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-60-21><a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-60-22><a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=p>}</span>
</span></code></pre></div> <h3 id=133-extension-traits>13.3. Extension Traits<a class=headerlink href=#133-extension-traits title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=c1>// Extend external types with project-specific behavior</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a><span class=k>pub</span><span class=w> </span><span class=k>trait</span><span class=w> </span><span class=n>VehicleExt</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>display_name</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>String</span><span class=p>;</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>is_recent</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=kt>bool</span><span class=p>;</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=p>}</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=k>impl</span><span class=w> </span><span class=n>VehicleExt</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Vehicle</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>display_name</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>String</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>        </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;{} {} {}&quot;</span><span class=p>,</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>year</span><span class=p>,</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>make</span><span class=p>.</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=bp>self</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a>
</span><span id=__span-61-12><a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=w>    </span><span class=k>fn</span><span class=w> </span><span class=nf>is_recent</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-61-13><a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>current_year</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chrono</span><span class=p>::</span><span class=n>Utc</span><span class=p>::</span><span class=n>now</span><span class=p>().</span><span class=n>year</span><span class=p>()</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u16</span><span class=p>;</span>
</span><span id=__span-61-14><a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=w>        </span><span class=bp>self</span><span class=p>.</span><span class=n>year</span><span class=p>.</span><span class=mi>0</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>current_year</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>3</span>
</span><span id=__span-61-15><a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-61-16><a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=134-type-state-pattern>13.4. Type State Pattern<a class=headerlink href=#134-type-state-pattern title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=c1>// Different states represented by types</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Unvalidated</span><span class=p>;</span>
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Validated</span><span class=p>;</span>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=o>&lt;</span><span class=n>S</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a><span class=w>    </span><span class=n>data</span><span class=p>:</span><span class=w> </span><span class=nc>VehicleData</span><span class=p>,</span>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=w>    </span><span class=n>_state</span><span class=p>:</span><span class=w> </span><span class=nc>PhantomData</span><span class=o>&lt;</span><span class=n>S</span><span class=o>&gt;</span><span class=p>,</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a><span class=p>}</span>
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a><span class=k>impl</span><span class=w> </span><span class=n>Vehicle</span><span class=o>&lt;</span><span class=n>Unvalidated</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>new</span><span class=p>(</span><span class=n>data</span><span class=p>:</span><span class=w> </span><span class=nc>VehicleData</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nc>Self</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a><span class=w>        </span><span class=bp>Self</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>_state</span><span class=p>:</span><span class=w> </span><span class=nc>PhantomData</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>validate</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Vehicle</span><span class=o>&lt;</span><span class=n>Validated</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>ValidationError</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-16><a id=__codelineno-62-16 name=__codelineno-62-16 href=#__codelineno-62-16></a><span class=w>        </span><span class=c1>// Validation logic</span>
</span><span id=__span-62-17><a id=__codelineno-62-17 name=__codelineno-62-17 href=#__codelineno-62-17></a><span class=w>        </span><span class=nb>Ok</span><span class=p>(</span><span class=n>Vehicle</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>data</span><span class=p>:</span><span class=w> </span><span class=nc>self</span><span class=p>.</span><span class=n>data</span><span class=p>,</span><span class=w> </span><span class=n>_state</span><span class=p>:</span><span class=w> </span><span class=nc>PhantomData</span><span class=w> </span><span class=p>})</span>
</span><span id=__span-62-18><a id=__codelineno-62-18 name=__codelineno-62-18 href=#__codelineno-62-18></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-62-19><a id=__codelineno-62-19 name=__codelineno-62-19 href=#__codelineno-62-19></a><span class=p>}</span>
</span><span id=__span-62-20><a id=__codelineno-62-20 name=__codelineno-62-20 href=#__codelineno-62-20></a>
</span><span id=__span-62-21><a id=__codelineno-62-21 name=__codelineno-62-21 href=#__codelineno-62-21></a><span class=k>impl</span><span class=w> </span><span class=n>Vehicle</span><span class=o>&lt;</span><span class=n>Validated</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-22><a id=__codelineno-62-22 name=__codelineno-62-22 href=#__codelineno-62-22></a><span class=w>    </span><span class=c1>// Only validated vehicles can be saved</span>
</span><span id=__span-62-23><a id=__codelineno-62-23 name=__codelineno-62-23 href=#__codelineno-62-23></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>save</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>,</span><span class=w> </span><span class=n>repo</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=k>impl</span><span class=w> </span><span class=n>VehicleRepository</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=p>()</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-62-24><a id=__codelineno-62-24 name=__codelineno-62-24 href=#__codelineno-62-24></a><span class=w>        </span><span class=n>repo</span><span class=p>.</span><span class=n>save</span><span class=p>(</span><span class=o>&amp;</span><span class=bp>self</span><span class=p>.</span><span class=n>data</span><span class=p>)</span>
</span><span id=__span-62-25><a id=__codelineno-62-25 name=__codelineno-62-25 href=#__codelineno-62-25></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-62-26><a id=__codelineno-62-26 name=__codelineno-62-26 href=#__codelineno-62-26></a><span class=p>}</span>
</span></code></pre></div> <hr> <h2 id=14-anti-patterns-to-avoid>14. Anti-Patterns to Avoid<a class=headerlink href=#14-anti-patterns-to-avoid title="Anchor link to this section for reference">&para;</a></h2> <h3 id=141-stringly-typed-code>14.1. Stringly-Typed Code<a class=headerlink href=#141-stringly-typed-code title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=c1>// Bad - relying on strings</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=k>fn</span><span class=w> </span><span class=nf>get_vehicle_field</span><span class=p>(</span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>,</span><span class=w> </span><span class=n>field</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Option</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=w>        </span><span class=s>&quot;make&quot;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>vehicle</span><span class=p>.</span><span class=n>make</span><span class=p>.</span><span class=n>clone</span><span class=p>()),</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a><span class=w>        </span><span class=s>&quot;model&quot;</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>Some</span><span class=p>(</span><span class=n>vehicle</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>clone</span><span class=p>()),</span>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=w>        </span><span class=n>_</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=nb>None</span><span class=p>,</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=p>}</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=c1>// Good - use enums</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=k>enum</span><span class=w> </span><span class=nc>VehicleField</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=w>    </span><span class=n>Make</span><span class=p>,</span>
</span><span id=__span-63-13><a id=__codelineno-63-13 name=__codelineno-63-13 href=#__codelineno-63-13></a><span class=w>    </span><span class=n>Model</span><span class=p>,</span>
</span><span id=__span-63-14><a id=__codelineno-63-14 name=__codelineno-63-14 href=#__codelineno-63-14></a><span class=w>    </span><span class=n>Year</span><span class=p>,</span>
</span><span id=__span-63-15><a id=__codelineno-63-15 name=__codelineno-63-15 href=#__codelineno-63-15></a><span class=p>}</span>
</span><span id=__span-63-16><a id=__codelineno-63-16 name=__codelineno-63-16 href=#__codelineno-63-16></a>
</span><span id=__span-63-17><a id=__codelineno-63-17 name=__codelineno-63-17 href=#__codelineno-63-17></a><span class=k>fn</span><span class=w> </span><span class=nf>get_vehicle_field</span><span class=p>(</span><span class=n>vehicle</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=nc>Vehicle</span><span class=p>,</span><span class=w> </span><span class=n>field</span><span class=p>:</span><span class=w> </span><span class=nc>VehicleField</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>String</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-18><a id=__codelineno-63-18 name=__codelineno-63-18 href=#__codelineno-63-18></a><span class=w>    </span><span class=k>match</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-63-19><a id=__codelineno-63-19 name=__codelineno-63-19 href=#__codelineno-63-19></a><span class=w>        </span><span class=n>VehicleField</span><span class=p>::</span><span class=n>Make</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>make</span><span class=p>.</span><span class=n>clone</span><span class=p>(),</span>
</span><span id=__span-63-20><a id=__codelineno-63-20 name=__codelineno-63-20 href=#__codelineno-63-20></a><span class=w>        </span><span class=n>VehicleField</span><span class=p>::</span><span class=n>Model</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>model</span><span class=p>.</span><span class=n>clone</span><span class=p>(),</span>
</span><span id=__span-63-21><a id=__codelineno-63-21 name=__codelineno-63-21 href=#__codelineno-63-21></a><span class=w>        </span><span class=n>VehicleField</span><span class=p>::</span><span class=n>Year</span><span class=w> </span><span class=o>=&gt;</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>year</span><span class=p>.</span><span class=n>to_string</span><span class=p>(),</span>
</span><span id=__span-63-22><a id=__codelineno-63-22 name=__codelineno-63-22 href=#__codelineno-63-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-63-23><a id=__codelineno-63-23 name=__codelineno-63-23 href=#__codelineno-63-23></a><span class=p>}</span>
</span></code></pre></div> <h3 id=142-overusing-clone>14.2. Overusing <code>clone()</code><a class=headerlink href=#142-overusing-clone title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=c1>// Bad - unnecessary clone</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>format_vehicles</span><span class=p>(</span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>Vehicle</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=w>    </span><span class=n>vehicles</span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>clone</span><span class=p>())</span><span class=w>  </span><span class=c1>// Unnecessary!</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;{} {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>make</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>model</span><span class=p>))</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>()</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=p>}</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=c1>// Good - just borrow</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=k>pub</span><span class=w> </span><span class=k>fn</span><span class=w> </span><span class=nf>format_vehicles</span><span class=p>(</span><span class=n>vehicles</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=p>[</span><span class=n>Vehicle</span><span class=p>])</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Vec</span><span class=o>&lt;</span><span class=nb>String</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-64-11><a id=__codelineno-64-11 name=__codelineno-64-11 href=#__codelineno-64-11></a><span class=w>    </span><span class=n>vehicles</span><span class=p>.</span><span class=n>iter</span><span class=p>()</span>
</span><span id=__span-64-12><a id=__codelineno-64-12 name=__codelineno-64-12 href=#__codelineno-64-12></a><span class=w>        </span><span class=p>.</span><span class=n>map</span><span class=p>(</span><span class=o>|</span><span class=n>v</span><span class=o>|</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;{} {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>make</span><span class=p>,</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>model</span><span class=p>))</span>
</span><span id=__span-64-13><a id=__codelineno-64-13 name=__codelineno-64-13 href=#__codelineno-64-13></a><span class=w>        </span><span class=p>.</span><span class=n>collect</span><span class=p>()</span>
</span><span id=__span-64-14><a id=__codelineno-64-14 name=__codelineno-64-14 href=#__codelineno-64-14></a><span class=p>}</span>
</span></code></pre></div> <h3 id=143-god-objects>14.3. God Objects<a class=headerlink href=#143-god-objects title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=c1>// Bad - one type does everything</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleManager</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>data</span><span class=p>:</span><span class=w> </span><span class=nc>Vehicle</span><span class=p>,</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>db_connection</span><span class=p>:</span><span class=w> </span><span class=nc>Connection</span><span class=p>,</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>http_client</span><span class=p>:</span><span class=w> </span><span class=nc>Client</span><span class=p>,</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=w>    </span><span class=k>pub</span><span class=w> </span><span class=n>cache</span><span class=p>:</span><span class=w> </span><span class=nc>Cache</span><span class=p>,</span>
</span><span id=__span-65-7><a id=__codelineno-65-7 name=__codelineno-65-7 href=#__codelineno-65-7></a><span class=w>    </span><span class=c1>// ... more responsibilities</span>
</span><span id=__span-65-8><a id=__codelineno-65-8 name=__codelineno-65-8 href=#__codelineno-65-8></a><span class=p>}</span>
</span><span id=__span-65-9><a id=__codelineno-65-9 name=__codelineno-65-9 href=#__codelineno-65-9></a>
</span><span id=__span-65-10><a id=__codelineno-65-10 name=__codelineno-65-10 href=#__codelineno-65-10></a><span class=c1>// Good - separate concerns</span>
</span><span id=__span-65-11><a id=__codelineno-65-11 name=__codelineno-65-11 href=#__codelineno-65-11></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>Vehicle</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* data only */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-65-12><a id=__codelineno-65-12 name=__codelineno-65-12 href=#__codelineno-65-12></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleRepository</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* persistence */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-65-13><a id=__codelineno-65-13 name=__codelineno-65-13 href=#__codelineno-65-13></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleService</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* business logic */</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-65-14><a id=__codelineno-65-14 name=__codelineno-65-14 href=#__codelineno-65-14></a><span class=k>pub</span><span class=w> </span><span class=k>struct</span><span class=w> </span><span class=nc>VehicleCache</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=cm>/* caching */</span><span class=w> </span><span class=p>}</span>
</span></code></pre></div> <h3 id=144-ignoring-results>14.4. Ignoring Results<a class=headerlink href=#144-ignoring-results title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=c1>// Bad - silently ignoring errors</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=kd>let</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>validate</span><span class=p>();</span><span class=w>  </span><span class=c1>// Error ignored!</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=c1>// Good - handle or propagate</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a><span class=n>vehicle</span><span class=p>.</span><span class=n>validate</span><span class=p>()</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a><span class=c1>// Or explicitly acknowledge</span>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=kd>let</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vehicle</span><span class=p>.</span><span class=n>validate</span><span class=p>()</span>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=w>    </span><span class=p>.</span><span class=n>map_err</span><span class=p>(</span><span class=o>|</span><span class=n>e</span><span class=o>|</span><span class=w> </span><span class=fm>eprintln!</span><span class=p>(</span><span class=s>&quot;Validation warning: {}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>e</span><span class=p>));</span>
</span></code></pre></div> <h3 id=145-using-unwrap-in-production-code>14.5. Using <code>unwrap()</code> in Production Code<a class=headerlink href=#145-using-unwrap-in-production-code title="Anchor link to this section for reference">&para;</a></h3> <div class="language-rust highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=c1>// Bad - can panic</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=n>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>).</span><span class=n>unwrap</span><span class=p>();</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=c1>// Good - handle error</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=n>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a>
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a><span class=c1>// Or provide context</span>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=kd>let</span><span class=w> </span><span class=n>vehicle</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>repository</span><span class=p>.</span><span class=n>find_by_id</span><span class=p>(</span><span class=o>&amp;</span><span class=n>id</span><span class=p>)</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=w>    </span><span class=p>.</span><span class=n>expect</span><span class=p>(</span><span class=s>&quot;Vehicle must exist at this point&quot;</span><span class=p>);</span><span class=w>  </span><span class=c1>// Only if truly infallible</span>
</span></code></pre></div> <hr> <h2 id=summary>Summary<a class=headerlink href=#summary title="Anchor link to this section for reference">&para;</a></h2> <p>Following these guidelines ensures:</p> <ol> <li><strong>Correctness</strong>: Type safety prevents invalid states</li> <li><strong>Maintainability</strong>: Clear separation of concerns and consistent patterns</li> <li><strong>Performance</strong>: Efficient use of Rust's zero-cost abstractions</li> <li><strong>Security</strong>: Proper input validation and secure practices</li> <li><strong>Testability</strong>: Dependency injection and trait-based design</li> <li><strong>Documentation</strong>: Self-documenting code with comprehensive docs</li> </ol> <p>When in doubt, prioritize: 1. <strong>Correctness</strong> over performance 2. <strong>Clarity</strong> over cleverness 3. <strong>Simplicity</strong> over optimization</p> <p>All code submitted to the project will be reviewed against these guidelines.</p> <hr> <p><strong>Last Updated</strong>: 2025-12-25</p> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../TESTING/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Testing"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Testing </div> </div> </a> <a href=../RELEASE_STRATEGY/ class="md-footer__link md-footer__link--next" aria-label="Next: Release Strategy"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Release Strategy </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 OpenEV Data Contributors </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/open-ev-data target=_blank rel=noopener title="OpenEV Data on GitHub" class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "content.tooltips", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>